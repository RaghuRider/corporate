---
ID: "9c67dfcb-4bf9-494d-bc18-3db16fabc820"
Parent: "cdd7e9dc-6bbd-4c64-89ae-1e1dc449b940"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: "/sitecore/media library/Themes/AIE/AIE Corporate Site/AIEnterprise/Scripts/component-carousel"
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/9C67DFCB4BF9494DBC183DB16FABC820.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "1da0e9ef-cf3d-4e2d-a098-c4baa56e2071"
  Value: LyoqDQogKiBYQUNvbnRleHQNCiAqDQogKiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzIG1vZHVsZS4NCiAqDQogKiBFeHBvc2VzIHJlZ2lzdGVyKHNlbGVjdG9yLCBvcHRpb25zKSBtZXRob2QsIHdoaWNoIGluaXRpYWxpemVzIENhcm91c2VsDQogKiBmb3IgZWFjaCBlbGVtZW50cyB0aGF0IG1hdGNoIHRoZSBwcm92aWRlZCBzZWxlY3Rvciwgd2l0aCBnaXZlbiBvcHRpb25zLg0KICogRWxlbWVudCB1c2VkIGFzIGEgY2Fyb3VzZWwgbXVzdCBjb250YWluIGEgPHVsIGNsYXNzPSJzbGlkZXMiPiB0YWcuDQogKiBUaGF0IHRhZyBoYXZlIHRvIGJlIGZpbGxlZCB3aXRoIDxsaT4gZWxlbWVudHMuIEVhY2ggPGxpPiBlbGVtZW50IHdpbGwgYmUgY29uc2lkZXJlZCBhcyBhIHNsaWRlLg0KICogRm9yIG1vcmUgZGV0YWlscyByZWFkIHRoZSBkb2N1bWVudGF0aW9uIG9mIGEgcmVnaXN0ZXIoc2VsZWN0b3IsIG9wdGlvbnMpIG1ldGhvZC4NCiAqDQogKiBAcmVxdWlyZXMgalF1ZXJ5IEphdmFTY3JpcHQgTGlicmFyeSB2MS40LjQgb3IgaGlnaGVyDQogKi8NCi8qIGdsb2JhbCBIYW1tZXI6dHJ1ZSAqLw0KWEEuY29tcG9uZW50LmNhcm91c2VscyA9IChmdW5jdGlvbigkKSB7DQogICAgdmFyIHB1YiA9IHt9LA0KICAgICAgICBOYXZpZ2F0aW9uQnVpbGRlciA9IG51bGwsDQogICAgICAgIFNsaWRlckluaXRpYWxpemVyID0gbnVsbDsNCg0KICAgIC8qKg0KICAgICAqIFRpbWVyIGNsYXNzIHNhdmVzIHRpbWUgc3RhbXAgYW5kIGNvdW50cyB0aW1lIGRpZmZlcmVuY2UgYmV0d2Vlbg0KICAgICAqIGN1cnJlbnQgdGltZSAodXBkYXRlKCkgbWV0aG9kKSBhbmQgc2F2ZWQgdGltZSBzdGFtcC4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBUaW1lcigpIHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFRpbWUgZGlmZmVyZW5jZSBiZXR3ZWVuIGxhc3QgdXBkYXRlKCkgY2FsbCBhbmQgbGFzdCBzZXQoKSBjYWxsDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgVGltZXINCiAgICAgICAgICovDQogICAgICAgIHRoaXMuZWxhcHNlZCA9IDA7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBUaW1lIHN0YW1wDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgVGltZXINCiAgICAgICAgICovDQogICAgICAgIHRoaXMuc3RhbXAgPSBudWxsOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqICBDb3VudHMgdGltZSBkaWZmZXJlbmNlIGJldHdlZW4gY3VycmVudCB0aW1lIGFuZCBzYXZlZCB0aW1lIHN0YW1wDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVyDQogICAgICovDQogICAgVGltZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBpZiAodGhpcy5zdGFtcCAhPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhpcy5lbGFwc2VkICs9IHRoaXMubmV3U3RhbXAoKSAtIHRoaXMuc3RhbXA7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogIFNhdmVzIG5ldyB0aW1lIHN0YW1wDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVyDQogICAgICovDQogICAgVGltZXIucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB0aGlzLnN0YW1wID0gdGhpcy5uZXdTdGFtcCgpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiAgQ291bnRzIHRpbWUgZGlmZmVyZW5jZSBiZXR3ZWVuIGN1cnJlbnQgdGltZSBhbmQgc2F2ZWQgdGltZSBzdGFtcA0KICAgICAqDQogICAgICogQG1lbWJlciBUaW1lcg0KICAgICAqIEByZXR1cm4gc3RhbXAgb2YgYSBjdXJyZW50IHRpbWUNCiAgICAgKiBAdHlwZSBOdW1iZXINCiAgICAgKi8NCiAgICBUaW1lci5wcm90b3R5cGUubmV3U3RhbXAgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCkudmFsdWVPZigpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiAgUmVzZXRzIGVsYXBzZWQgdGltZS4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVGltZXINCiAgICAgKi8NCiAgICBUaW1lci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy5lbGFwc2VkID0gMDsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEVuZCBvZiBUaW1lciBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogVGltZUluZGljYXRvciBjbGFzcyBleHRlbmRzIFRpbWVyIGNsYXNzDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICogQHBhcmFtIHtPYmplY3R9ICQgICAgIGEgalF1ZXJ5IG9iamVjdA0KICAgICAqIEBwYXJhbSB7WEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5WaWV3fSB2aWV3ICBhIHRpbWUgaW5kaWNhdG9yIHZpZXcuDQogICAgICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVvdXQgICBhIHZpZXcgdGltZW91dA0KICAgICAqIEBiYXNlIFRpbWVyDQogICAgICovDQogICAgZnVuY3Rpb24gVGltZUluZGljYXRvcigkLCB2aWV3LCB0aW1lb3V0KSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBBIHRpbWUgaW5kaWNhdG9yIHZpZXcuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgVGltZXJJbmRpY2F0b3INCiAgICAgICAgICovDQogICAgICAgIHRoaXMudmlldyA9IHZpZXc7DQoNCiAgICAgICAgdGhpcy52aWV3LmluaXQodGltZW91dCk7DQogICAgfQ0KICAgIFRpbWVJbmRpY2F0b3IucHJvdG90eXBlID0gbmV3IFRpbWVyKCk7DQogICAgVGltZUluZGljYXRvci5jb25zdHJ1Y3RvciA9IFRpbWVyOw0KDQogICAgLyoqDQogICAgICogUGxheXMgdGhlIGF0dGFjaGVkIHZpZXcuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVySW5kaWNhdG9yDQogICAgICovDQogICAgVGltZUluZGljYXRvci5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB0aGlzLnZpZXcucGxheSgpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBQYXVzZXMgdGhlIGF0dGFjaGVkIHZpZXcuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVySW5kaWNhdG9yDQogICAgICovDQogICAgVGltZUluZGljYXRvci5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy52aWV3LnBhdXNlKCk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFJlc2V0cyBlbGFwc2VkIHRpbWUgYW5kIHJlc2V0cyB0aGUgYXR0YWNoZWQgdmlldy4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVGltZXJJbmRpY2F0b3INCiAgICAgKi8NCiAgICBUaW1lSW5kaWNhdG9yLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBUaW1lci5wcm90b3R5cGUucmVzZXQuY2FsbCh0aGlzKTsNCiAgICAgICAgdGhpcy52aWV3LnJlc2V0KCk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENvdW50cyB0aW1lIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRpbWUgYW5kIHNhdmVkIHRpbWUgc3RhbXAuDQogICAgICogYW5kIHVwZGF0ZXMgdGhlIGF0dGFjaGVkIHZpZXcNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVGltZXJJbmRpY2F0b3INCiAgICAgKi8NCiAgICBUaW1lSW5kaWNhdG9yLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgVGltZXIucHJvdG90eXBlLnVwZGF0ZS5jYWxsKHRoaXMpOw0KICAgICAgICB0aGlzLnZpZXcudXBkYXRlKHRoaXMuZWxhcHNlZCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgVGltZUluZGljYXRvciBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogTmF2aWdhdGlvbkJ1aWxkZXIgb2JqZWN0IGNyZWF0ZXMgbmF2aWdhdGlvbiBpdGVtcw0KICAgICAqLw0KICAgIE5hdmlnYXRpb25CdWlsZGVyID0gKGZ1bmN0aW9uKCQpIHsNCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlSXRlbShzZXR0aW5ncykgew0KICAgICAgICAgICAgdmFyIHRleHQgPSBzZXR0aW5ncy50ZXh0LA0KICAgICAgICAgICAgICAgICRuYXZJdGVtID0gbnVsbDsNCg0KICAgICAgICAgICAgc2V0dGluZ3MudGV4dCA9ICcnOw0KICAgICAgICAgICAgc2V0dGluZ3MuaHJlZiA9ICcjJzsNCg0KICAgICAgICAgICAgJG5hdkl0ZW0gPSAkKCc8YT4nLCBzZXR0aW5ncyk7DQogICAgICAgICAgICAkKCc8c3Bhbj4nLCB7DQogICAgICAgICAgICAgICAgJ3RleHQnOiB0ZXh0DQogICAgICAgICAgICB9KS5hcHBlbmRUbygkbmF2SXRlbSk7DQoNCiAgICAgICAgICAgIHJldHVybiAkbmF2SXRlbTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIFJldHVybnMgdGhlIGVsZW1lbnQocykgdGhhdCBtYXRjaChlcykgdGhlIHByb3ZpZGVkIHNlbGVjdG9yIG9yIG51bGwNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3IgYSBzZWxlY3RvciB1c2VkIGZvciBzZWFyY2hpbmcNCiAgICAgICAgICAgICAqIEByZXR1cm4gYSBqUXVlcnkgb2JqZWN0IGNvbnRhaW5pbmcgZWxlbWVudChzKSB0aGF0IG1hdGNoKGVzKSB0aGUgcHJvdmlkZWQgc2VsZWN0b3Igb3IgbnVsbCBpZiBubyBlbGVtZW50IG1hdGNoDQogICAgICAgICAgICAgKiBAdHlwZSBPYmplY3QNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgZ2V0RWxlbWVudDogZnVuY3Rpb24oc2VsZWN0b3IpIHsNCiAgICAgICAgICAgICAgICB2YXIgJGVsZW1lbnQgPSAkKHNlbGVjdG9yKTsNCg0KICAgICAgICAgICAgICAgIGlmICgkZWxlbWVudC5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQgPSBudWxsOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHJldHVybiAkZWxlbWVudDsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIENyZWF0ZXMgbmF2aWdhdGlvbiBpdGVtcyBhbmQgYXBwZW5kcyB0aGVtIHRvICRjb250YWluZXIuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9ICRjb250YWluZXIgICBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciAoalF1ZXJ5IG9iamVjdCkNCiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBsYWJlbCAgIG5hdmlnYXRpb24gaXRlbXMgbGFiZWwgdGVtcGxhdGUNCiAgICAgICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb3VudCAgICBudW1iZXIgb2YgbmF2aWdhdGlvbiBpdGVtcyB0byBjcmVhdGUNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgY3JlYXRlSXRlbXM6IGZ1bmN0aW9uKCRjb250YWluZXIsIGxhYmVsLCBjb3VudCkgew0KICAgICAgICAgICAgICAgIHZhciBpLA0KICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuID0gLyNce2luZGV4XH0vZywNCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M7DQoNCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0JzogbGFiZWwucmVwbGFjZShwYXR0ZXJuLCBpICsgMSkNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlSXRlbShzZXR0aW5ncykuYXBwZW5kVG8oJGNvbnRhaW5lcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogQ3JlYXRlcyBvciBzZWxlY3RzICdwcmV2aW91cycvJ25leHQnIG5hdmlnYXRpb24gaXRlbS4NCiAgICAgICAgICAgICAqIE1vZGUgb2YgYWN0aW9uIGRlcGVuZHMgb24gc2V0dGluZ3Mgb2JqZWN0Og0KICAgICAgICAgICAgICogdmFyIHNldHRpbmdzID0gew0KICAgICAgICAgICAgICogICAgIGlzQ29udGFpbmVyOiBCb29sZWFuIHZhbHVlLA0KICAgICAgICAgICAgICogICAgIGxhYmVsOiBTdHJpbmcgdmFsdWUsDQogICAgICAgICAgICAgKiAgICAgc2VsZWN0b3I6IFN0cmluZyB2YWx1ZSwNCiAgICAgICAgICAgICAqICAgICBtZXRob2Q6IFN0cmluZyB2YWx1ZQ0KICAgICAgICAgICAgICogfTsNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBJZiBzZXR0aW5ncy5zZWxlY3RvciA9PT0gbnVsbCBvciBpZiBzZXR0aW5ncy5zZWxlY3RvciAhPT0gbnVsbCBhbmQgc2V0dGluZ3MuaXNDb250YWluZXIgPT0gdHJ1ZQ0KICAgICAgICAgICAgICogbmF2aWdhdGlvbiBpdGVtIGlzIGNyZWF0ZWQgYW5kIGF0dGFjaGVkIHRvICRlbGVtZW50LmZpcnN0KCkgKHVzaW5nIHNldHRpbmdzLm1ldGhvZCkuDQogICAgICAgICAgICAgKiBJZiBzZXR0aW5ncy5zZWxlY3RvciAhPT0gbnVsbCBhbmQgc2V0dGluZ3MuaXNDb250YWluZXIgPT0gZmFsc2UNCiAgICAgICAgICAgICAqICRlbGVtZW50LmZpcnN0KCkgaXMgc2VsZWN0ZWQgYXMgbmF2aWdhdGlvbiBpdGVtDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIHNldHRpbmdzIG9mIG5hdmlnYXRpb24gaXRlbQ0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGl0ZW1TZXR0aW5ncyAgIGh0bWwgYXR0cmlidXRlcyBvZiBuYXZpZ2F0aW9uIGl0ZW0NCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkZWxlbWVudCAgICBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciAoalF1ZXJ5IG9iamVjdCkNCiAgICAgICAgICAgICAqIEByZXR1cm4gVGhlICdwcmV2Jy8nbmV4dCcgbmF2aWdhdGlvbiBpdGVtDQogICAgICAgICAgICAgKiBAdHlwZSBPYmplY3QNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgY3JlYXRlUHJldk5leHRJdGVtOiBmdW5jdGlvbihzZXR0aW5ncywgaXRlbVNldHRpbmdzLCAkZWxlbWVudCkgew0KICAgICAgICAgICAgICAgIHZhciAkaXRlbSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgIGlzU2VsZWN0b3JFeGlzdHMgPSBzZXR0aW5ncy5zZWxlY3RvciAhPT0gbnVsbDsNCg0KDQogICAgICAgICAgICAgICAgaWYgKGlzU2VsZWN0b3JFeGlzdHMpIHsNCiAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQgPSB0aGlzLmdldEVsZW1lbnQoc2V0dGluZ3Muc2VsZWN0b3IpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmICgkZWxlbWVudCAhPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MuaXNDb250YWluZXIgfHwgIWlzU2VsZWN0b3JFeGlzdHMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtID0gY3JlYXRlSXRlbSgkLmV4dGVuZCh7fSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0Jzogc2V0dGluZ3MubGFiZWwNCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGl0ZW1TZXR0aW5ncykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgKCRlbGVtZW50LmZpcnN0KCkpW3NldHRpbmdzLm1ldGhvZF0oJGl0ZW0pOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgJGl0ZW0gPSAkZWxlbWVudC5maXJzdCgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgcmV0dXJuICRpdGVtOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgIH0oJCkpOw0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBOYXZpZ2F0aW9uQnVpbGRlciBvYmplY3QNCiAgICAgKi8NCg0KICAgIC8qKg0KICAgICAqIE5hdmlnYXRpb24gY2xhc3MgaG9sZHMgbmF2aWdhdGlvbiBpdGVtcy4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBOYXZpZ2F0aW9uKCQsICR3cmFwcGVyLCBvcHRpb25zKSB7DQogICAgICAgIHZhciBkZWZhdWx0cyA9IHsNCiAgICAgICAgICAgICAgICAnaXNFbmFibGVkJzogdHJ1ZSwNCiAgICAgICAgICAgICAgICAnaGFzUHJldk5leHRJdGVtcyc6IHRydWUsDQogICAgICAgICAgICAgICAgJ2l0ZW0nOiB7DQogICAgICAgICAgICAgICAgICAgICdsYWJlbCc6ICcje2luZGV4fScsDQogICAgICAgICAgICAgICAgICAgICdzZWxlY3Rvcic6IG51bGwNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICdwcmV2SXRlbSc6IHsNCiAgICAgICAgICAgICAgICAgICAgJ2xhYmVsJzogJzwnLA0KICAgICAgICAgICAgICAgICAgICAnc2VsZWN0b3InOiBudWxsLA0KICAgICAgICAgICAgICAgICAgICAnaXNDb250YWluZXInOiBmYWxzZQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgJ25leHRJdGVtJzogew0KICAgICAgICAgICAgICAgICAgICAnbGFiZWwnOiAnPicsDQogICAgICAgICAgICAgICAgICAgICdzZWxlY3Rvcic6IG51bGwsDQogICAgICAgICAgICAgICAgICAgICdpc0NvbnRhaW5lcic6IGZhbHNlDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAnc2xpZGVzQ291bnQnOiAwDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2V0dGluZ3MgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMsIG9wdGlvbnMpOw0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBqUXVlcnkgb2JqZWN0DQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy4kID0gJDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIE5hdmlnYXRpb24gaXRlbXMgKG9uZSBmb3IgZWFjaCBzbGlkZSBpZiBuYXZpZ2F0aW9uIGlzIGVuYWJsZWQpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJGl0ZW1zID0gJCgpOw0KICAgICAgICAvKioNCiAgICAgICAgICogTmF2aWdhdGlvbiAnbmV4dCcgaXRlbSAoaWYgcHJldi9uZXh0IGl0ZW1zIGFyZSBlbmFibGVkKS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiRuZXh0SXRlbSA9ICQoKTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIE5hdmlnYXRpb24gJ3ByZXZpb3VzJyBpdGVtIChpZiBwcmV2L25leHQgaXRlbXMgYXJlIGVuYWJsZWQpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJHByZXZJdGVtID0gJCgpOw0KICAgICAgICAvKioNCiAgICAgICAgICogU2VsZWN0ZWQgaXRlbSAob25lIGZyb20gdGhpcy4kaXRlbXMgb3IgbnVsbCkuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy4kc2VsZWN0ZWRJdGVtID0gbnVsbDsNCg0KICAgICAgICAvL2luaXRpYWxpemF0aW9uDQogICAgICAgIGlmIChzZXR0aW5ncy5pc0VuYWJsZWQpIHsNCiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsNCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgc2VsZi5wcmVwYXJlSXRlbXMoc2V0dGluZ3MuaXRlbSwgc2V0dGluZ3Muc2xpZGVzQ291bnQsICR3cmFwcGVyKTsNCiAgICAgICAgICAgICAgICAvL3NlbGVjdCBmaXJzdCBpdGVtIG9uIGluaXQNCiAgICAgICAgICAgICAgICBzZWxmLnNlbGVjdEl0ZW0oMCkNCiAgICAgICAgICAgIH0sIDEwMDApOw0KDQogICAgICAgICAgICAkd3JhcHBlci5maW5kKCcubmF2JykudHJpZ2dlcignbmF2aWdhdGlvbi1jcmVhdGVkJywgdGhpcyk7DQoNCg0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ1NTIGNsYXNzbSB3aGljaCB3aWxsIGJlIHVzZWQgZm9yIG1hcmsgc2VsZWN0ZWQgaXRlbQ0KICAgICAqDQogICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICovDQogICAgTmF2aWdhdGlvbi5wcm90b3R5cGUuc2VsZWN0ZWRJdGVtQ2xhc3MgPSAnYWN0aXZlJzsNCg0KICAgIC8qKg0KICAgICAqIE1hcmsgbmF2aWdhdGlvbiBpdGVtIHdpdGggZ2l2ZW4gaW5kZXggYXMgc2VsZWN0ZWQuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggICAgIGluZGV4IG9mIG5hdmlnYXRpb24gaXRlbQ0KICAgICAqLw0KICAgIE5hdmlnYXRpb24ucHJvdG90eXBlLnNlbGVjdEl0ZW0gPSBmdW5jdGlvbiAoaW5kZXgpIHsNCiAgICAgICAgaWYgKHRoaXMuJHNlbGVjdGVkSXRlbSAhPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhpcy4kc2VsZWN0ZWRJdGVtLnJlbW92ZUNsYXNzKHRoaXMuc2VsZWN0ZWRJdGVtQ2xhc3MpOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuJHNlbGVjdGVkSXRlbSA9IHRoaXMuJGl0ZW1zLmVxKGluZGV4KS5hZGRDbGFzcyh0aGlzLnNlbGVjdGVkSXRlbUNsYXNzKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBvciBzZWxlY3RzIG5hdmlnYXRpb24gaXRlbXMgY29udGFpbmVyIGFuZCBmaWxscyBpdCB3aXRoIG5hdmlnYXRpb24gaXRlbXMuDQogICAgICogSWYgbmF2aWdhdGlvbiBpdGVtcyBjb250YWluZXIgaXMgbm90IGVtcHR5LCBjaGlsZCBlbGVtZW50cyBhcmUgYWRvcHRlZCBhcyBuYXZpZ2F0aW9uIGl0ZW1zLg0KICAgICAqIE1vZGUgb2YgYWN0aW9uIGRlcGVuZHMgb24gc2V0dGluZ3Mgb2JqZWN0Og0KICAgICAqIHZhciBzZXR0aW5ncyA9IHsNCiAgICAgKiAgICAgJ2xhYmVsJzogJyN7aW5kZXh9JywNCiAgICAgKiAgICAgJ3NlbGVjdG9yJzogbnVsbA0KICAgICAqIH07DQogICAgICogSWYgc2V0dGluZ3Muc2VsZWN0b3IgPT09IG51bGwgbmF2aWdhdGlvbiBpdGVtIGNvbnRhaW5lciBpcyBjcmVhdGVkLg0KICAgICAqIElmIHNldHRpbmdzLnNlbGVjdG9yICE9PSBudWxsIGVsZW1lbnQgdGhhdCBtYXRjaCBzZXR0aW5ncy5zZWxlY3RvciBpcyBhZGFwdGVkIGFzIG5hdmlnYWdhdGlvbiBpdGVtcyBjb250YWluZXIuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3Mgc2V0dGluZ3Mgb2YgbmF2aWdhdGlvbiBpdGVtcw0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb3VudCAgIG51bWJlciBvZiBuYXZpZ2F0aW9uIGl0ZW1zDQogICAgICogQHBhcmFtIHtPYmplY3R9ICR3cmFwcGVyICAgIHdyYXBwZXIgb2YgbmF2aWdhdGlvbiBpdGVtcyBjb250YWluZXIgKGpRdWVyeSBvYmplY3QpDQogICAgICogQHJldHVybiBUaGUgY29udGFpbmVyIGZpbGxlZCB3aXRoIG5hdmlnYXRpb24gaXRlbXMuDQogICAgICogQHR5cGUgT2JqZWN0DQogICAgICovDQogICAgTmF2aWdhdGlvbi5wcm90b3R5cGUucHJlcGFyZUl0ZW1zID0gZnVuY3Rpb24oc2V0dGluZ3MsIGNvdW50LCAkd3JhcHBlcikgew0KICAgICAgICB2YXIgJGNvbnRhaW5lciA9IG51bGw7DQoNCiAgICAgICAgaWYgKHNldHRpbmdzLnNlbGVjdG9yICE9PSBudWxsKSB7DQogICAgICAgICAgICAkY29udGFpbmVyID0gTmF2aWdhdGlvbkJ1aWxkZXIuZ2V0RWxlbWVudChzZXR0aW5ncy5zZWxlY3Rvcik7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAkY29udGFpbmVyID0gJCgnPGRpdi8+Jywgew0KICAgICAgICAgICAgICAgICdjbGFzcyc6ICduYXYnDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICRjb250YWluZXIuYXBwZW5kVG8oJHdyYXBwZXIpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCRjb250YWluZXIgIT09IG51bGwpIHsNCiAgICAgICAgICAgIGlmICgkY29udGFpbmVyLmNoaWxkcmVuKCkubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICAgICAgTmF2aWdhdGlvbkJ1aWxkZXIuY3JlYXRlSXRlbXMoJGNvbnRhaW5lciwgc2V0dGluZ3MubGFiZWwsIGNvdW50KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMuJGl0ZW1zID0gJGNvbnRhaW5lci5jaGlsZHJlbigpLnNsaWNlKDAsIGNvdW50KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiAkY29udGFpbmVyOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIG9yIHNlbGVjdHMgbmF2aWdhdGlvbiAncHJldmlvdXMnIGFuZCAnbmV4dCcgbmF2aWdhdGlvbiBpdGVtcyAoQHNlZSBOYXZpZ2F0aW9uQnVpbGRlci5jcmVhdGVQcmV2TmV4dEl0ZW0oKSkuDQogICAgICogSWYgbmF2aWdhdGlvbiBpdGVtcyBjb250YWluZXIgaXMgbm90IGVtcHR5LCBjaGlsZCBlbGVtZW50cyBhcmUgYWRvcHRlZCBhcyBuYXZpZ2F0aW9uIGl0ZW1zLg0KICAgICAqDQogICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIHNldHRpbmdzIG9mIG5hdmlnYXRpb24NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gJGNvbnRhaW5lciAgICBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciAoalF1ZXJ5IG9iamVjdCkNCiAgICAgKi8NCiAgICBOYXZpZ2F0aW9uLnByb3RvdHlwZS5wcmVwYXJlUHJldk5leHRJdGVtcyA9IGZ1bmN0aW9uKHNldHRpbmdzLCAkY29udGFpbmVyKSB7DQogICAgICAgIHZhciAkaXRlbTsNCg0KICAgICAgICBzZXR0aW5ncy5wcmV2SXRlbS5tZXRob2QgPSAncHJlcGVuZCc7DQogICAgICAgICRpdGVtID0gTmF2aWdhdGlvbkJ1aWxkZXIuY3JlYXRlUHJldk5leHRJdGVtKHNldHRpbmdzLnByZXZJdGVtLCB7DQogICAgICAgICAgICAnY2xhc3MnOiAncHJldicNCiAgICAgICAgfSwgJGNvbnRhaW5lcik7DQogICAgICAgIHRoaXMuJHByZXZJdGVtID0gKCRpdGVtID09PSBudWxsKSA/IHRoaXMuJHByZXZJdGVtIDogJGl0ZW07DQoNCiAgICAgICAgc2V0dGluZ3MubmV4dEl0ZW0ubWV0aG9kID0gJ2FwcGVuZCc7DQogICAgICAgICRpdGVtID0gTmF2aWdhdGlvbkJ1aWxkZXIuY3JlYXRlUHJldk5leHRJdGVtKHNldHRpbmdzLm5leHRJdGVtLCB7DQogICAgICAgICAgICAnY2xhc3MnOiAnbmV4dCcNCiAgICAgICAgfSwgJGNvbnRhaW5lcik7DQogICAgICAgIHRoaXMuJG5leHRJdGVtID0gKCRpdGVtID09PSBudWxsKSA/IHRoaXMuJG5leHRJdGVtIDogJGl0ZW07DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgTmF2aWdhdGlvbiBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogU2xpZGVyQ29udGV4dCBjbGFzcyBpcyBiaW5kZWQgdG8gYSBTbGlkZXIgY2xhc3MgaW5zdGFuY2UNCiAgICAgKiBhbmQgaG9sZHMgaXRzIHByb3BlcnRpZXMuDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICovDQogICAgZnVuY3Rpb24gU2xpZGVyQ29udGV4dCgpIHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIEZsYWcsIHdoaWNoIGRldGVybWluZXMgaWYgc2xpZGUgY2FuIG9yIGNhbiBub3QgYmUgY2hhbmdlZCAoZm9yIHVzZXIgcmVxdWVzdCkNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmNhbkNoYW5nZVNsaWRlID0gdHJ1ZTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIERlZmF1bHQgU2xpZGVyIHNldHRpbmcgb2JqZWN0IChAc2VlIFNsaWRlcikNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmRlZmF1bHRzID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIE5hdmlnYXRpb24gb2JqZWN0IChAc2VlIE5hdmlnYXRpb24pDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFNsaWRlciBvYmplY3QsIHdoaWNoIHRoaXMgY29udGV4dCBpcyBhdHRhY2VoZCB0by4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLm93bmVyID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIEZsYWcsIHdoaWNoIGRldGVybWluZXMgaWYgY2hhbmdlIG9mIGEgc2xpZGUgY2FuIG9yIGNhbiBub3QgYmUgc2NoZWR1bGVkDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5wcmV2ZW50U2NoZWR1bGluZyA9IGZhbHNlOw0KICAgICAgICAvKioNCiAgICAgICAgICogU2xpZGVyIHNldHRpbmcgb2JqZWN0DQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbnN0YW5jZSBvZiBUaW1lciBjbGFzcyAoQHNlZSBUaW1lciksIHdoaWNoIGlzIHVzZWQgdG8gc3RvcmUgaG93IG11Y2gNCiAgICAgICAgICogdGltZSBpcyBsZWZ0IHRvIGNoYW5nZSB0aGUgc2xpZGUNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnNsaWRlVGltZXIgPSBuZXcgVGltZXIoKTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIEluc3RhbmNlIG9mIFRpbWVJbmRpY2F0b3IgY2xhc3MgKEBzZWUgVGltZUluZGljYXRvcikNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnRpbWVJbmRpY2F0b3IgPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogVGltZXJzIGFycmF5Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMudGltZXJzID0gW107DQogICAgICAgIC8qKg0KICAgICAgICAgKiBMYXN0IHRpbWVvdXQgaWRlbnRpZmllci4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnRpbWVvdXRJZCA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBUcmFuc2l0aW9uIChAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuVHJhbnNpdGlvbikgdXNlZCB3aGlsZSBjaGFuZ2luZyBzbGlkZXMNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnRyYW5zaXRpb24gPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogVHJhbnNpdGlvbiBzZXR0aW5ncyBvYmplY3QgKEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5UcmFuc2l0aW9uU2V0dGluZ3MpDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy50cmFuc2l0aW9uU2V0dGluZ3MgPSBuZXcgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5UcmFuc2l0aW9uU2V0dGluZ3MoKTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIGpRdWVyeSBvYmplY3Qgd2hpY2ggY29udGFpbnMgYWxsIHNsaWRlcw0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJHNsaWRlcyA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBqUXVlcnkgb2JqZWN0IGNvbnRhaW5pbmcgZWxlbWVudCB0aGF0IHdyYXBwcyBzbGlkZXMNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiR3cmFwcGVyID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFJlZmVyZW5jZSB0byBtZXRob2QsIHdoaWNoIHNob3VsZCBjaGFuZ2UgY3VycmVudCBzbGlkZQ0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuY2hhbmdlQ3VycmVudFNsaWRlID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFJlZmVyZW5jZSB0byBtZXRob2QsIHdoaWNoIHNob3VsZCByZXR1cm4galF1ZXJ5IG9iamVjdCB3aXRoIGN1cnJlbnQgc2xpZGUNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmdldEN1cnJlbnRTbGlkZSA9IG51bGw7DQoNCiAgICAgICAgdGhpcy50aW1lcnMucHVzaCh0aGlzLnNsaWRlVGltZXIpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBlbmQgb2YgU2xpZGVyQ29udGV4dCBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogU2xpZGVyIGNsYXNzIG1hbmFnZXMgY2hhbmdpbmcgb2Ygc2xpZGVzLg0KICAgICAqDQogICAgICogT3B0aW9ucyBvYmplY3Q6DQogICAgICogew0KICAgICAqICAgICAnbmF2aWdhdGlvbic6IE9iamVjdCB2YWx1ZSwgLy9uYXZpZ2F0aW9uIHNldHRpbmdzIG9iamVjdA0KICAgICAqICAgICAndGltZW91dCc6IE51bWJlciB2YWx1ZSwgLy90aW1lIGJldHdlZW4gc2xpZGVzIGNoYW5naW5nDQogICAgICogICAgICd0cmFuc2l0aW9uJzogU3RyaW5nIHZhbHVlLCAvL25hbWUgb2YgdHJhbnNpdGlvbiBjbGFzcyAoQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zLlRyYW5zaXRpb24pDQogICAgICogICAgICdpc1BhdXNlRW5hYmxlZCc6IEJvb2xlYW4gdmFsdWUsIC8vZmxhZywgd2hpY2ggZGV0ZXJtaW5lcyBpZiBwYXVzZSBmZWF0dXJlIGlzIGVuYWJsZWQNCiAgICAgKiAgICAgJ3RpbWVJbmRpY2F0b3InOiB7DQogICAgICogICAgICAgICAnaXNFbmFibGVkJzogQm9vbGVhbiB2YWx1ZSwgLy9mbGFnLCB3aGljaCBkZXRlcm1pbmVzIGlmIHRpbWUgaW5kaWNhdG9yIGlzIGVuYWJsZWQNCiAgICAgKiAgICAgICAgICdzZWxlY3Rvcic6IFN0cmluZyB2YWx1ZSwgLy9zZWxlY3RvciBvZiB0aW1lIGluZGljYXRvciBodG1sIGVsZW1lbnQNCiAgICAgKiAgICAgICAgICd2aWV3JzogU3RyaW5nIHZhbHVlLCAvL25hbWUgb2YgdmlldyBjbGFzcyAoQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzLlZpZXcNCiAgICAgKiAgICAgICAgICdvcHRpb25zJzogT2JqZWN0IHZhbHVlIC8vb2JqZWN0IHdpdGggb3B0aW9ucywgd2hpY2ggd2lsbCBiZSBwYXNzZWQgdG8gYSB0aW1lIGluZGljYXRvciB2aWV3DQogICAgICogICAgIH0NCiAgICAgKiB9DQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICogQHBhcmFtIHtPYmplY3R9ICQgICAgIHRoZSBqUXVlcnkgb2JqZWN0DQogICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgIGluc3RhbmNlIG9mIFNsaWRlckNvbnRleHQgY2xhc3M7IG11c3QgYmUgc2VwYXJhdGUgZm9yIGVhY2ggaW5zdGFuY2UgKEBzZWUgU2xpZGVyQ29udGV4dCkNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAgICBTbGlkZXIgb3B0aW9ucyBvYmplY3QNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBTbGlkZXIoJCwgY29udGV4dCwgb3B0aW9ucykgew0KICAgICAgICB2YXIgZGVmYXVsdHMgPSB7DQogICAgICAgICAgICAnbmF2aWdhdGlvbic6IHt9LA0KICAgICAgICAgICAgJ3RpbWVvdXQnOiAxMDAwMCwNCiAgICAgICAgICAgICd0cmFuc2l0aW9uJzogJ0Jhc2ljVHJhbnNpdGlvbicsDQogICAgICAgICAgICAnaXNQYXVzZUVuYWJsZWQnOiB0cnVlLA0KICAgICAgICAgICAgJ3RpbWVJbmRpY2F0b3InOiB7DQogICAgICAgICAgICAgICAgJ2lzRW5hYmxlZCc6IGZhbHNlLA0KICAgICAgICAgICAgICAgICdzZWxlY3Rvcic6IG51bGwsDQogICAgICAgICAgICAgICAgJ3ZpZXcnOiAnVmlldycsDQogICAgICAgICAgICAgICAgJ29wdGlvbnMnOiB7fQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbnN0YW5jZSBvZiBTbGlkZXJDb250ZXh0IGNsYXNzIChAc2VlIFNsaWRlckNvbnRleHQpDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDsNCg0KICAgICAgICBjb250ZXh0Lm93bmVyID0gdGhpczsNCiAgICAgICAgY29udGV4dC5kZWZhdWx0cyA9IGRlZmF1bHRzOw0KICAgICAgICBjb250ZXh0LnNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBvcHRpb25zKTsNCiAgICAgICAgY29udGV4dC50cmFuc2l0aW9uU2V0dGluZ3MuJHNsaWRlcyA9IGNvbnRleHQuJHNsaWRlczsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBFeGVjdXRlcyBtZXRob2Qgd2l0aCBnaXZlbiBtZXRob2ROYW1lIG9uIGVhY2ggVGltZXIgaW4gY29udGV4dC50aW1lcnMgKEBzZWUgVGltZXIpDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFNsaWRlcg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBtZXRob2ROYW1lICAgbmFtZSBvZiBhIG1ldGhvZCwgd2hpY2ggd2lsbCBiZSBleGVjdXRlZCBvbiB0aW1lcnMNCiAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICAgY3VycmVudCBjb250ZXh0DQogICAgICovDQogICAgU2xpZGVyLnByb3RvdHlwZS5leGVjdXRlT25UaW1lcnMgPSBmdW5jdGlvbihtZXRob2ROYW1lLCBjb250ZXh0KSB7DQogICAgICAgIHZhciBpID0gbnVsbCwNCiAgICAgICAgICAgIHRpbWVyID0gbnVsbCwNCiAgICAgICAgICAgIHRpbWVycyA9IGNvbnRleHQudGltZXJzOw0KDQogICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aW1lcnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHRpbWVyID0gdGltZXJzW2ldOw0KICAgICAgICAgICAgaWYgKHR5cGVvZih0aW1lclttZXRob2ROYW1lXSkgPT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAgICAgICB0aW1lclttZXRob2ROYW1lXSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIERlc2NoZWR1bGVzIGNoYW5nZSBvZiBhIHNsaWRlLCBieSBjbGVhcmluZyB0aW1lb3V0IHByZXZpb3VzbHkgc2V0IGJ5IHNldFRpZW1vdXQoKSBmdW5jdGlvbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgU2xpZGVyDQogICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgIGN1cnJlbnQgY29udGV4dA0KICAgICAqLw0KICAgIFNsaWRlci5wcm90b3R5cGUuZGVzY2hlZHVsZVNsaWRlID0gZnVuY3Rpb24oY29udGV4dCkgew0KICAgICAgICBpZiAoY29udGV4dC50aW1lb3V0SWQgIT09IG51bGwpIHsNCiAgICAgICAgICAgIGNsZWFyVGltZW91dChjb250ZXh0LnRpbWVvdXRJZCk7DQogICAgICAgICAgICBjb250ZXh0LnRpbWVvdXRJZCA9IG51bGw7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogU2NoZWR1bGVzIGNoYW5nZSBvZiBhIHNsaWRlLCBieSBzZXR0aW5nIHRpbWVvdXQgKHVzaW5nIHNldFRpZW1vdXQoKSBmdW5jdGlvbikgaWYgY2FuLg0KICAgICAqIElmIGNhbid0LCB0cmllcyBhZ2FpbiBhZnRlciBzaG9ydCBwZXJpb2Qgb2YgdGltZS4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgU2xpZGVyDQogICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgIGN1cnJlbnQgY29udGV4dA0KICAgICAqLw0KICAgIFNsaWRlci5wcm90b3R5cGUuc2NoZWR1bGVTbGlkZSA9IGZ1bmN0aW9uKGNvbnRleHQpIHsNCiAgICAgICAgdmFyIG93bmVyID0gY29udGV4dC5vd25lcjsNCg0KICAgICAgICBvd25lci5kZXNjaGVkdWxlU2xpZGUoY29udGV4dCk7DQoNCiAgICAgICAgaWYgKCFjb250ZXh0LnByZXZlbnRTY2hlZHVsaW5nICYmIGNvbnRleHQuJHNsaWRlcy5sZW5ndGggPiAxKSB7DQogICAgICAgICAgICBvd25lci5leGVjdXRlT25UaW1lcnMoJ3NldCcsIGNvbnRleHQpOw0KDQogICAgICAgICAgICBpZiAoY29udGV4dC5jYW5DaGFuZ2VTbGlkZSkgew0KICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LnRpbWVJbmRpY2F0b3IgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC50aW1lSW5kaWNhdG9yLnBsYXkoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY29udGV4dC50aW1lb3V0SWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICBvd25lci5jaGFuZ2VDdXJyZW50U2xpZGVCeSgxLCBjb250ZXh0KTsNCiAgICAgICAgICAgICAgICB9LCBjb250ZXh0LnNldHRpbmdzLnRpbWVvdXQgLSBjb250ZXh0LnNsaWRlVGltZXIuZWxhcHNlZCk7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgIG93bmVyLnNjaGVkdWxlU2xpZGUoY29udGV4dCk7DQogICAgICAgICAgICAgICAgfSwgMTAwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBDaGFuZ2VzIGN1cnJlbnQgc2xpZGUsIGJ5IG9mZnNldCBwZXJmb3JtaW5nIGNvbnRleHQudHJhbnNpdGlvbg0KICAgICAqIEFueSBvZmZzZXQgdmFsdWUgaXMgc2F2ZSAoaWYgaXQgaXMgYW4gaW50ZWdlcikuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFNsaWRlcg0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBvZmZzZXQgICAgdGhlIG9mZnNldCB0byBhbiBpbmRleCBvZiBhIG5ldyBzbGlkZQ0KICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgICBjdXJyZW50IGNvbnRleHQNCiAgICAgKi8NCiAgICBTbGlkZXIucHJvdG90eXBlLmNoYW5nZUN1cnJlbnRTbGlkZUJ5ID0gZnVuY3Rpb24ob2Zmc2V0LCBjb250ZXh0KSB7DQogICAgICAgIHZhciBzZXR0aW5ncyA9IGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzLA0KICAgICAgICAgICAgJGN1cnJlbnRTbGlkZSA9IGNvbnRleHQuZ2V0Q3VycmVudFNsaWRlKCksDQogICAgICAgICAgICAkc2xpZGVzID0gY29udGV4dC4kc2xpZGVzOw0KDQogICAgICAgIGlmICgob2Zmc2V0ICUgJHNsaWRlcy5sZW5ndGgpICE9PSAwKSB7DQogICAgICAgICAgICBjb250ZXh0LmNhbkNoYW5nZVNsaWRlID0gZmFsc2U7DQoNCiAgICAgICAgICAgIHNldHRpbmdzLm9mZnNldCA9IG9mZnNldDsNCiAgICAgICAgICAgIHNldHRpbmdzLiRjdXJyZW50U2xpZGUgPSAkY3VycmVudFNsaWRlOw0KICAgICAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZSA9ICRzbGlkZXMuZXEoKCRjdXJyZW50U2xpZGUuaW5kZXgoKSArIG9mZnNldCkgJSAkc2xpZGVzLmxlbmd0aCk7DQoNCiAgICAgICAgICAgIGNvbnRleHQuY2hhbmdlQ3VycmVudFNsaWRlKHNldHRpbmdzLiRuZXh0U2xpZGUpOw0KICAgICAgICAgICAgY29udGV4dC50cmFuc2l0aW9uLnBlcmZvcm0oY29udGV4dC50cmFuc2l0aW9uU2V0dGluZ3MsIG9mZnNldCk7DQogICAgICAgICAgICBjb250ZXh0Lm93bmVyLmV4ZWN1dGVPblRpbWVycygncmVzZXQnLCBjb250ZXh0KTsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgdmFyICRjYXJvdXNlbCA9ICQoY29udGV4dC4kd3JhcHBlcikucGFyZW50cygiLmNhcm91c2VsIik7DQogICAgICAgICRjYXJvdXNlbC50cmlnZ2VyKCJzbGlkZS1jaGFuZ2VkIik7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFN0YXJ0cyBhdXRvbWF0aWMgc2xpZGVzIGNoYW5naW5nDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFNsaWRlcg0KICAgICAqLw0KICAgIFNsaWRlci5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHRoaXMuZXhlY3V0ZU9uVGltZXJzKCdyZXNldCcsIHRoaXMuY29udGV4dCk7DQogICAgICAgIHRoaXMuc2NoZWR1bGVTbGlkZSh0aGlzLmNvbnRleHQpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBDYW5jZWwgdGhlIGRlZmF1bHQgYWN0aW9uIG9mIGV2ZW50IGFuZCBjaGFuZ2VzIHNsaWRlIG1hbnVhbGx5Lg0KICAgICAqDQogICAgICogQG1lbWJlciBTbGlkZXINCiAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgICAgIHRoZSBldmVudA0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBvZmZzZXQgICAgdGhlIG9mZnNldCB0byBhbiBpbmRleCBvZiBhIG5ldyBzbGlkZQ0KICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgICBjdXJyZW50IGNvbnRleHQNCiAgICAgKi8NCiAgICBTbGlkZXIucHJvdG90eXBlLm9uQ2hhbmdlQ3VycmVudFNsaWRlID0gZnVuY3Rpb24oZXZlbnQsIG9mZnNldCwgY29udGV4dCkgew0KICAgICAgICB2YXIgb3duZXIgPSBjb250ZXh0Lm93bmVyOw0KDQogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIGlmIChjb250ZXh0LmNhbkNoYW5nZVNsaWRlKSB7DQogICAgICAgICAgICBvd25lci5kZXNjaGVkdWxlU2xpZGUoY29udGV4dCk7DQogICAgICAgICAgICBvd25lci5jaGFuZ2VDdXJyZW50U2xpZGVCeShvZmZzZXQsIGNvbnRleHQpOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFNlbGVjdHMgbmF2aWdhdGlvbiBpdGVtIHdpdGggZ2l2ZW4gaW5kZXguDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFNsaWRlcg0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleCAgICAgdGhlIGluZGV4IG9mIG5hdmlnYXRpb24gaXRlbQ0KICAgICAqLw0KICAgIFNsaWRlci5wcm90b3R5cGUuc2VsZWN0TmF2aWdhdGlvbkl0ZW0gPSBmdW5jdGlvbihpbmRleCkgew0KICAgICAgICB0aGlzLmNvbnRleHQubmF2aWdhdGlvbi5zZWxlY3RJdGVtKGluZGV4KTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBTbGlkZXIgY2xhc3MNCiAgICAgKi8NCg0KICAgIC8qKg0KICAgICAqIFNsaWRlckluaXRpYWxpemVyIG9iamVjdCBzZXQgdXAgaW5zdGFuY2VzIG9mIFNsaWRlciBjbGFzcw0KICAgICAqLw0KICAgIFNsaWRlckluaXRpYWxpemVyID0gKGZ1bmN0aW9uKCQpIHsNCiAgICAgICAgdmFyIERJUkVDVElPTiA9IHsNCiAgICAgICAgICAgIFBSRVY6IC0xLA0KICAgICAgICAgICAgTkVYVDogMQ0KICAgICAgICB9Ow0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBBdHRhY2hlcyBldmVudHMgdG8gbmF2aWdhdGlvbiBpdGVtcy4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgYSBjb250ZXh0IG9mIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBhdHRhY2hOYXZpZ2F0aW9uRXZlbnRzKGNvbnRleHQpIHsNCiAgICAgICAgICAgIHZhciBvd25lciA9IGNvbnRleHQub3duZXIsDQogICAgICAgICAgICAgICAgJG5hdkxpbmtzID0gY29udGV4dC4kd3JhcHBlci5maW5kKCIubmF2LWl0ZW1zIiksDQogICAgICAgICAgICAgICAgJHByZXZJdGVtVHh0ID0gY29udGV4dC4kd3JhcHBlci5maW5kKCcucHJldi10ZXh0JyksDQogICAgICAgICAgICAgICAgJG5leHRJdGVtVHh0ID0gY29udGV4dC4kd3JhcHBlci5maW5kKCcubmV4dC10ZXh0JyksDQogICAgICAgICAgICAgICAgJGNhcm91c2VsID0gY29udGV4dC4kd3JhcHBlci5wYXJlbnRzKCIuY2Fyb3VzZWwiKTsNCg0KICAgICAgICAgICAgY29udGV4dC5uYXZpZ2F0aW9uLiRpdGVtcy5lYWNoKGZ1bmN0aW9uIChpbmRleCkgew0KICAgICAgICAgICAgICAgIHZhciAkc2xpZGUgPSBjb250ZXh0LiRzbGlkZXMuZXEoaW5kZXgpOw0KDQogICAgICAgICAgICAgICAgJCh0aGlzKS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgICAgICAgICAgICAgb3duZXIub25DaGFuZ2VDdXJyZW50U2xpZGUoZXZlbnQsICRzbGlkZS5pbmRleCgpIC0gY29udGV4dC5nZXRDdXJyZW50U2xpZGUoKS5pbmRleCgpLCBjb250ZXh0KTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAkcHJldkl0ZW1UeHQuY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgc3dpdGNoU2xpZGUoZXZlbnQsIGNvbnRleHQsIERJUkVDVElPTi5QUkVWKTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAkbmV4dEl0ZW1UeHQuY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgc3dpdGNoU2xpZGUoZXZlbnQsIGNvbnRleHQsIERJUkVDVElPTi5ORVhUKTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICBjb250ZXh0Lm5hdmlnYXRpb24uJHByZXZJdGVtLmNsaWNrKGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgICAgICAgICAgIHN3aXRjaFNsaWRlKGV2ZW50LCBjb250ZXh0LCBESVJFQ1RJT04uUFJFVik7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgY29udGV4dC5uYXZpZ2F0aW9uLiRuZXh0SXRlbS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2hTbGlkZShldmVudCwgY29udGV4dCwgRElSRUNUSU9OLk5FWFQpOw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICRuYXZMaW5rcy5vbigia2V5ZG93biIsIGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkgew0KICAgICAgICAgICAgICAgICAgICBjYXNlIDM3OiAvL0xldGYgYXJyb3cNCiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaFNsaWRlKGV2ZW50LCBjb250ZXh0LCBESVJFQ1RJT04uUFJFVik7DQogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmZpbmQoIi5hY3RpdmUiKS5mb2N1cygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgMzk6IC8vUmlnaHQgYXJyb3cNCiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaFNsaWRlKGV2ZW50LCBjb250ZXh0LCBESVJFQ1RJT04uTkVYVCk7DQogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmZpbmQoIi5hY3RpdmUiKS5mb2N1cygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgMTM6IC8vRW50ZXINCiAgICAgICAgICAgICAgICAgICAgICAgIGZvY3VzRmlyc3RGb2N1c2FibGVFbGVtZW50KG93bmVyLmNvbnRleHQuZ2V0Q3VycmVudFNsaWRlKCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAkY2Fyb3VzZWwub24oInNsaWRlLWNoYW5nZWQiLCBmdW5jdGlvbihldmVudCl7DQogICAgICAgICAgICAgICAgdmFyICRhY3RpdmVMaW5rID0gJG5hdkxpbmtzLmZpbmQoIi5hY3RpdmUiKTsNCiAgICAgICAgICAgICAgICAkYWN0aXZlTGluay5hdHRyKCd0YWJpbmRleCcsICcwJyk7DQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYoJG5hdkxpbmtzLmZpbmQoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkubGVuZ3RoKXsNCiAgICAgICAgICAgICAgICAgICAgJGFjdGl2ZUxpbmsuZm9jdXMoKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAkbmF2TGlua3MuZmluZCgiPmRpdiIpLm5vdCgnLmFjdGl2ZScpLmF0dHIoJ3RhYmluZGV4JywgJy0xJyk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBTd2l0Y2ggc2xpZGVzIGJhY2sgYW5kIGZvcmV3YXJkDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50ICAgICAgICAgICAgICBhbiBldmVudCB3aGljaCBjYXVzZWQgc3dpdGNoIHNsaWRlIGFjdGlvbg0KICAgICAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICAgYSBjb250ZXh0IG9mIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlDQogICAgICAgICAqIEBwYXJhbSB7bnVtYmVyfSBkaXJlY3Rpb24gICAgICAgICBzd2l0Y2ggc2xpZGUgZGlyZWN0aW9uLiAtMSAtIHN3aXRjaCB0byBwcmV2IHNsaWRlLiAxIC0gc3dpdGNoIHRvIHRoZSBuZXh0IHNsaWRlDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBzd2l0Y2hTbGlkZShldmVudCwgY29udGV4dCwgZGlyZWN0aW9uKSB7DQogICAgICAgICAgICB2YXIgb3duZXIgPSBjb250ZXh0Lm93bmVyLA0KICAgICAgICAgICAgICAgIG5hdkxpbmtzJCA9IGNvbnRleHQuJHdyYXBwZXIuZmluZCgiLm5hdi1pdGVtcyIpOw0KDQogICAgICAgICAgICBuYXZMaW5rcyQuZmluZCgiLmFjdGl2ZSIpLmF0dHIoJ3RhYmluZGV4JywgJy0xJyk7DQogICAgICAgICAgICBvd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShldmVudCwgZGlyZWN0aW9uLCBjb250ZXh0KTsNCiAgICAgICAgICAgIG5hdkxpbmtzJC5maW5kKCIuYWN0aXZlIikuYXR0cigndGFiaW5kZXgnLCAnMCcpOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEZvY3VzIHRoZSBmaXJzdCBmb2N1c2FibGUgZWxlbWVudCBpbnNpZGUgY29udGFpbmVyDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7Q29udGFpbmVyfSBjb250YWluZXIgIGEgY29udGFpbmVyIGVsZW1lbnQgd2hlcmUgdGhlIGZpcnN0IGZvY3VzYWJsZSBlbGVtZW50IHdpbGwgYmUgZm9jdXNlZA0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gZm9jdXNGaXJzdEZvY3VzYWJsZUVsZW1lbnQoY29udGFpbmVyKSB7DQogICAgICAgICAgICB2YXIgZm9jdXNhYmxlRWxlbWVudHNTdHJpbmcgPSAnYVtocmVmXSwgYXJlYVtocmVmXSwgaW5wdXQ6bm90KFtkaXNhYmxlZF0pLCBzZWxlY3Q6bm90KFtkaXNhYmxlZF0pLCB0ZXh0YXJlYTpub3QoW2Rpc2FibGVkXSksIGJ1dHRvbjpub3QoW2Rpc2FibGVkXSksIGlmcmFtZSwgb2JqZWN0LCBlbWJlZCwgW3RhYmluZGV4PSIwIl0sIFtjb250ZW50ZWRpdGFibGVdJzsNCg0KICAgICAgICAgICAgLy8gRmluZCBhbGwgZm9jdXNhYmxlIGNoaWxkcmVuDQogICAgICAgICAgICB2YXIgZm9jdXNhYmxlRWxlbWVudHMgPSBjb250YWluZXIuZmluZChmb2N1c2FibGVFbGVtZW50c1N0cmluZyk7DQoNCiAgICAgICAgICAgIC8vIElmIHRoZXJlIGFyZSBmb2N1c2FibGUgZWxlbWVudHMgLSBzZWxlY3QgdGhlIGZpcnN0IG9uZQ0KICAgICAgICAgICAgaWYgKGZvY3VzYWJsZUVsZW1lbnRzLmxlbmd0aCAhPT0gMCkgew0KICAgICAgICAgICAgICAgIHZhciBmaXJzdFRhYlN0b3AgPSBmb2N1c2FibGVFbGVtZW50c1swXTsNCg0KICAgICAgICAgICAgICAgIC8vIEZvY3VzIGZpcnN0DQogICAgICAgICAgICAgICAgZmlyc3RUYWJTdG9wLmZvY3VzKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogQXR0YWNoZXMgcGF1c2UgZXZlbnQgdG8gbmF2aWdhdGlvbiB3cmFwcGVyLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICBhIGNvbnRleHQgb2YgYSBTbGlkZXIgY2xhc3MgaW5zdGFuY2UNCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGF0dGFjaFBhdXNlRXZlbnQoY29udGV4dCkgew0KICAgICAgICAgICAgdmFyIG93bmVyID0gY29udGV4dC5vd25lciwNCiAgICAgICAgICAgICAgICAkZWxlbWVudCA9IGNvbnRleHQuJHdyYXBwZXIsDQogICAgICAgICAgICAgICAgJG5hdkxpbmtzID0gJGVsZW1lbnQuZmluZCgiLm5hdiBhIik7DQoNCiAgICAgICAgICAgIHZhciBjYWxsYmFja01vdXNlZW50ZXIgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBjb250ZXh0LnByZXZlbnRTY2hlZHVsaW5nID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBvd25lci5kZXNjaGVkdWxlU2xpZGUoY29udGV4dCk7DQoNCiAgICAgICAgICAgICAgICBvd25lci5leGVjdXRlT25UaW1lcnMoJ3VwZGF0ZScsIGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LnRpbWVJbmRpY2F0b3IgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC50aW1lSW5kaWNhdG9yLnBhdXNlKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkZWxlbWVudC5tb3VzZWVudGVyKGNhbGxiYWNrTW91c2VlbnRlcik7DQogICAgICAgICAgICAkbmF2TGlua3Mub24oImZvY3VzIiwgY2FsbGJhY2tNb3VzZWVudGVyKTsNCg0KICAgICAgICAgICAgdmFyIGNhbGxiYWNrTW91c2VMZWF2ZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGNvbnRleHQucHJldmVudFNjaGVkdWxpbmcgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBvd25lci5zY2hlZHVsZVNsaWRlKGNvbnRleHQpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkZWxlbWVudC5tb3VzZWxlYXZlKGNhbGxiYWNrTW91c2VMZWF2ZSk7DQogICAgICAgICAgICAkbmF2TGlua3Mub24oImJsdXIiLCBjYWxsYmFja01vdXNlTGVhdmUpOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENyZWF0ZXMgdGltZSBpbmRpY2F0b3Igdmlldw0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICBhIGNvbnRleHQgb2YgYSBTbGlkZXIgY2xhc3MgaW5zdGFuY2UNCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUluZGljYXRvcihjb250ZXh0KSB7DQogICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSBjb250ZXh0LnNldHRpbmdzLA0KICAgICAgICAgICAgICAgIHRpbWVJbmRpY2F0b3IgPSBudWxsLA0KICAgICAgICAgICAgICAgIFZpZXdDb25zdHJ1Y3RvciA9IFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3Nbc2V0dGluZ3MudGltZUluZGljYXRvci52aWV3XSwNCiAgICAgICAgICAgICAgICB2aWV3ID0gbnVsbDsNCg0KICAgICAgICAgICAgaWYgKFZpZXdDb25zdHJ1Y3RvciAhPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHZpZXcgPSBuZXcgVmlld0NvbnN0cnVjdG9yKHNldHRpbmdzLnRpbWVJbmRpY2F0b3Iuc2VsZWN0b3IsIHNldHRpbmdzLnRpbWVJbmRpY2F0b3Iub3B0aW9ucyk7DQogICAgICAgICAgICAgICAgdGltZUluZGljYXRvciA9IG5ldyBUaW1lSW5kaWNhdG9yKCQsIHZpZXcsIHNldHRpbmdzLnRpbWVvdXQpOw0KICAgICAgICAgICAgICAgIGNvbnRleHQudGltZUluZGljYXRvciA9IHRpbWVJbmRpY2F0b3I7DQogICAgICAgICAgICAgICAgY29udGV4dC50aW1lcnMucHVzaCh0aW1lSW5kaWNhdG9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBBdHRhY2hlcyBldmVudHMgdG8gbmF2aWdhdGlvbi4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgYSBjb250ZXh0IG9mIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBpbml0aWFsaXplTmF2aWdhdGlvbihjb250ZXh0KSB7DQogICAgICAgICAgICBjb250ZXh0LnNldHRpbmdzLm5hdmlnYXRpb24uc2xpZGVzQ291bnQgPSBjb250ZXh0LiRzbGlkZXMubGVuZ3RoOw0KICAgICAgICAgICAgY29udGV4dC5uYXZpZ2F0aW9uID0gbmV3IE5hdmlnYXRpb24oJCwgY29udGV4dC4kd3JhcHBlciwgY29udGV4dC5zZXR0aW5ncy5uYXZpZ2F0aW9uKTsNCg0KICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBhdHRhY2hOYXZpZ2F0aW9uRXZlbnRzKGNvbnRleHQpOw0KICAgICAgICAgICAgfSwgMTAwMCk7DQoNCg0KICAgICAgICAgICAgaWYgKGNvbnRleHQuc2V0dGluZ3MuaXNQYXVzZUVuYWJsZWQpIHsNCiAgICAgICAgICAgICAgICBhdHRhY2hQYXVzZUV2ZW50KGNvbnRleHQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEluaXRpYWxpemVzIHRyYW5zaXRpb24gZm9yIGEgZ2l2ZW4gY29udGV4dC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgYSBjb250ZXh0IG9mIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBpbml0aWFsaXplVHJhbnNpdGlvbihjb250ZXh0KSB7DQogICAgICAgICAgICB2YXIgVHJhbnNpdGlvbkNvbnN0cnVjdG9yID0gbnVsbCwNCiAgICAgICAgICAgICAgICBvd25lciA9IGNvbnRleHQub3duZXI7DQoNCiAgICAgICAgICAgIGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzLmNhbGxiYWNrID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgY29udGV4dC5jYW5DaGFuZ2VTbGlkZSA9IHRydWU7DQoNCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5wcmV2ZW50U2NoZWR1bGluZykgew0KICAgICAgICAgICAgICAgICAgICBvd25lci5leGVjdXRlT25UaW1lcnMoJ3Jlc2V0JywgY29udGV4dCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgb3duZXIuc2NoZWR1bGVTbGlkZShjb250ZXh0KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBUcmFuc2l0aW9uQ29uc3RydWN0b3IgPSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zW2NvbnRleHQuc2V0dGluZ3MudHJhbnNpdGlvbl07DQogICAgICAgICAgICBpZiAoKFRyYW5zaXRpb25Db25zdHJ1Y3RvciA9PT0gbnVsbCkgfHwgKFRyYW5zaXRpb25Db25zdHJ1Y3RvciA9PT0gdW5kZWZpbmVkKSkgew0KICAgICAgICAgICAgICAgIFRyYW5zaXRpb25Db25zdHJ1Y3RvciA9IFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnNbY29udGV4dC5kZWZhdWx0cy50cmFuc2l0aW9uXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnRleHQudHJhbnNpdGlvbiA9IG5ldyBUcmFuc2l0aW9uQ29uc3RydWN0b3IoKTsNCiAgICAgICAgICAgIGNvbnRleHQudHJhbnNpdGlvbi5pbml0KGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIEluaXRpYWxpemVzIFNsaWRlciBvYmplY3Qgd2l0aCBhIGdpdmVuIGNvbnRleHQuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgYSBjb250ZXh0IG9mIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKGNvbnRleHQpIHsNCiAgICAgICAgICAgICAgICBpbml0aWFsaXplTmF2aWdhdGlvbihjb250ZXh0KTsNCiAgICAgICAgICAgICAgICBpbml0aWFsaXplVHJhbnNpdGlvbihjb250ZXh0KTsNCg0KICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LnNldHRpbmdzLnRpbWVJbmRpY2F0b3IuaXNFbmFibGVkKSB7DQogICAgICAgICAgICAgICAgICAgIGNyZWF0ZUluZGljYXRvcihjb250ZXh0KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH07DQogICAgfSgkKSk7DQogICAgLyoqDQogICAgICogZW5kIG9mIFNsaWRlckluaXRpYWxpemVyDQogICAgICovDQoNCiAgICAvKioNCiAgICAgKiBDYXJvdXNlbCBjbGFzcyBkaXNwbGF5cyBvbmUgc2xpZGUgKHNvbWUgY29udGVudCkgYXQgdGhlIHRpbWUuDQogICAgICogSXRzIGJlaGF2aW91ciBkZXBlbmRzIG9uIHNldHRpbmdzIChwYXNzZWQgdG8gaW5pdCgpIG1ldGhvZCkuDQogICAgICogRm9yIG1vcmUgZGV0YWlscyBAc2VlIFNsaWRlciwgQHNlZSBTbGlkZXJJbml0aWFsaXplciwgQHNlZSBOYXZpZ2F0aW9uLA0KICAgICAqIEBzZWUgTmF2aWdhdGlvbkJ1aWxkZXIsIEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5UcmFuc2l0aW9uLA0KICAgICAqIEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5WaWV3DQogICAgICoNCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBDYXJvdXNlbCgpIHsNCiAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzOw0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbnN0YW5jZSBvZiBhIFNsaWRlciBjbGFzcyAoQHNlZSBTbGlkZXIpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnNsaWRlciA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBEaXNwbGF5ZWQgc2xpZGUgKGpRdWVyeSBvYmplY3QpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiRjdXJyZW50U2xpZGUgPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogQWxsIHNsaWRlcyAoalF1ZXJ5IG9iamVjdCkuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgQ2Fyb3VzZWwNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJHNsaWRlcyA9IG51bGw7DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENoYW5nZXMgY3VycmVudCBzbGlkZSB0byBhICRuZXdTbGlkZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBDYXJvdXNlbA0KICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gJG5ld1NsaWRlICB0aGUgbmV3IHNsaWRlIChqUXVlcnkpIG9iamVjdC4NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuY2hhbmdlQ3VycmVudFNsaWRlID0gZnVuY3Rpb24oJG5ld1NsaWRlKSB7DQogICAgICAgICAgICBjb250ZXh0LiRjdXJyZW50U2xpZGUgPSAkbmV3U2xpZGU7DQogICAgICAgICAgICBjb250ZXh0LnNsaWRlci5zZWxlY3ROYXZpZ2F0aW9uSXRlbSgkbmV3U2xpZGUuaW5kZXgoKSk7DQogICAgICAgIH07DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIFJldHVybnMgY3VycmVudCBzbGlkZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBDYXJvdXNlbA0KICAgICAgICAgKiBAcmV0dXJuIGN1cnJlbnQgc2xpZGUgKGpRdWVyeSkgb2JqZWN0Lg0KICAgICAgICAgKiBAdHlwZSBPYmplY3QNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuZ2V0Q3VycmVudFNsaWRlID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICByZXR1cm4gY29udGV4dC4kY3VycmVudFNsaWRlOw0KICAgICAgICB9Ow0KDQogICAgICAgIHRoaXMuZGF0YSA9IHt9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJlc2V0cyB0aGUgY2Fyb3VzZWwuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICovDQogICAgQ2Fyb3VzZWwucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHRoaXMuJHNsaWRlcy5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgJCh0aGlzKS5oaWRlKCk7DQogICAgICAgIH0pOw0KDQogICAgICAgIHRoaXMuY2hhbmdlQ3VycmVudFNsaWRlKHRoaXMuJHNsaWRlcy5maXJzdCgpKTsNCiAgICAgICAgdGhpcy4kY3VycmVudFNsaWRlLnNob3coKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogSW5pdGlhbGl6ZXMgdGhlIGNhcm91c2VsLg0KICAgICAqIFdyYXBwcyBjYXJvdXNlbCBjb250ZW50IHdpdGggPGRpdiBjbGFzcz0id3JhcHBlciIgLz4gZWxlbWVudCwNCiAgICAgKiBzZWxlY3RzIHNsaWRlcyAoPGxpIC8+IGVsZW1lbnRzKSBmcm9tIDx1bCBjbGFzcz0ic2xpZGVzIiAvPiBlbGVtZW50LA0KICAgICAqIGluaXRpYWxpemVzIFNsaWRlciBjbGFzcyBpbmN0YW5jZSwgcmVzZXRzIHRoZSBjYXJvdXNlbCBhbmQgc3RhcnQgYXV0b21hdGljIHNsaWRlcyBjaGFuZ2luZy4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgQ2Fyb3VzZWwNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gJGNvbnRhaW5lciAgICAgalF1ZXJ5IG9iamVjdCB3aXRoIGEgbWFpbiBodG1sIGVsZW1lbnQgb2YgdGhlIGNhcm91c2VsDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgICAgIGNhcm91c2VsIG9wdGlvbnMgb2JqZWN0DQogICAgICovDQogICAgQ2Fyb3VzZWwucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbigkY29udGFpbmVyLCBvcHRpb25zKSB7DQogICAgICAgIHZhciAkd3JhcHBlciA9ICQoJzxkaXYvPicsIHsNCiAgICAgICAgICAgICAgICAnY2xhc3MnOiAnd3JhcHBlcicNCiAgICAgICAgICAgIH0pLA0KICAgICAgICAgICAgc2xpZGVyQ29udGV4dCA9IG51bGw7DQoNCiAgICAgICAgJHdyYXBwZXIuYXBwZW5kKCRjb250YWluZXIuY2hpbGRyZW4oKS5kZXRhY2goKSk7DQogICAgICAgICRjb250YWluZXIuYXBwZW5kKCR3cmFwcGVyKTsNCiAgICAgICAgdGhpcy4kc2xpZGVzID0gJGNvbnRhaW5lci5maW5kKCcuc2xpZGVzIGxpLnNsaWRlJyk7DQoNCiAgICAgICAgc2xpZGVyQ29udGV4dCA9IG5ldyBTbGlkZXJDb250ZXh0KCk7DQogICAgICAgIHNsaWRlckNvbnRleHQuY2hhbmdlQ3VycmVudFNsaWRlID0gdGhpcy5jaGFuZ2VDdXJyZW50U2xpZGU7DQogICAgICAgIHNsaWRlckNvbnRleHQuZ2V0Q3VycmVudFNsaWRlID0gdGhpcy5nZXRDdXJyZW50U2xpZGU7DQogICAgICAgIHNsaWRlckNvbnRleHQuJHNsaWRlcyA9IHRoaXMuJHNsaWRlczsNCiAgICAgICAgc2xpZGVyQ29udGV4dC4kd3JhcHBlciA9ICR3cmFwcGVyOw0KDQogICAgICAgIHRoaXMuc2xpZGVyID0gbmV3IFNsaWRlcigkLCBzbGlkZXJDb250ZXh0LCBvcHRpb25zKTsNCiAgICAgICAgU2xpZGVySW5pdGlhbGl6ZXIuaW5pdGlhbGl6ZShzbGlkZXJDb250ZXh0KTsNCg0KICAgICAgICB0aGlzLnJlc2V0KCk7DQogICAgICAgIHRoaXMuc2xpZGVyLnJ1bigpOw0KICAgIH07DQogICAgLyoqDQogICAgICogZW5kIG9mIENhcm91c2VsIGNsYXNzDQogICAgICovDQogICANCg0KICAgIC8qIENhcm91c2VsIHRvdWNoIHN1cHBvcnQgKi8NCiAgICBDYXJvdXNlbC5wcm90b3R5cGUuc3dpcGVTbGlkZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgc2VsZiA9IHRoaXMsDQogICAgICAgICAgICAkd3JhcHBlciA9IHRoaXMuc2xpZGVyLmNvbnRleHQuJHdyYXBwZXIsDQogICAgICAgICAgICBoYW1tZXIgPSBuZXcgSGFtbWVyKCR3cmFwcGVyWzBdKTsNCiAgICAgICAgaGFtbWVyLmdldCgncGFuJykuc2V0KHsgZGlyZWN0aW9uOiBIYW1tZXIuRElSRUNUSU9OX0hPUklaT05UQUwgfSk7DQoNCiAgICAgICAgaGFtbWVyLm9uKCJzd2lwZWxlZnQiLCBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICBzZWxmLnNsaWRlci5jb250ZXh0Lm93bmVyLm9uQ2hhbmdlQ3VycmVudFNsaWRlKGUsIDEsIHNlbGYuc2xpZGVyLmNvbnRleHQpOw0KICAgICAgICB9KTsNCg0KICAgICAgICBoYW1tZXIub24oInN3aXBlcmlnaHQiLCBmdW5jdGlvbihlKSB7DQogICAgICAgICAgICBzZWxmLnNsaWRlci5jb250ZXh0Lm93bmVyLm9uQ2hhbmdlQ3VycmVudFNsaWRlKGUsIC0xLCBzZWxmLnNsaWRlci5jb250ZXh0KTsNCiAgICAgICAgfSk7DQogICAgfTsNCiAgICANCiAgICBDYXJvdXNlbC5wcm90b3R5cGUubWF4U2xpZGVJbmZvSGVpZ2h0ID0gZnVuY3Rpb24oKXsNCiAgICAgICAgdmFyIG1heEhlaWdodCA9IDAsDQogICAgICAgICAgICBzbGlkZUluZm8gPSB0aGlzLiRzbGlkZXNbMF0ucXVlcnlTZWxlY3RvcignLnNsaWRlLWluZm8nKQ0KICAgICAgICBpZiAoc2xpZGVJbmZvKXsNCiAgICAgICAgICAgIG1heEhlaWdodCA9IHNsaWRlSW5mby5vZmZzZXRIZWlnaHQ7DQogICAgICAgIH07DQogICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgdGhpcy4kc2xpZGVzLmxlbmd0aDsgaSsrKXsNCiAgICAgICAgICAgIHZhciBjdXJyU2xpZGVJbmZvSGVpZ2h0ID0gdGhpcy4kc2xpZGVzW2ldLnF1ZXJ5U2VsZWN0b3IoJy5zbGlkZS1pbmZvJykub2Zmc2V0SGVpZ2h0DQogICAgICAgICAgICBpZiAobWF4SGVpZ2h0IDxjdXJyU2xpZGVJbmZvSGVpZ2h0ICl7DQogICAgICAgICAgICAgICAgbWF4SGVpZ2h0ID0gY3VyclNsaWRlSW5mb0hlaWdodDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbWF4SGVpZ2h0Ow0KICAgIH0NCg0KICAgIENhcm91c2VsLnByb3RvdHlwZS5yZXNpemVXcmFwcGVyID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICB2YXIgc2xpZGVJbmZvSGVpZ2h0ID0gdGhpcy5tYXhTbGlkZUluZm9IZWlnaHQoKSwNCiAgICAgICAgICAgICAgICB3cmFwcGVyID0gdGhpcy5zbGlkZXIuY29udGV4dC4kd3JhcHBlcjsNCiAgICAgICAgICAgIHdyYXBwZXIuZmluZCgnLnNsaWRlLWluZm8nKS5jc3Moew0KICAgICAgICAgICAgICAgICdtaW4taGVpZ2h0Jzogc2xpZGVJbmZvSGVpZ2h0DQogICAgICAgICAgICB9KTsNCiAgICAgICAgDQogICAgfTsNCg0KICAgIHB1Yi5pbml0SW5zdGFuY2UgPSBmdW5jdGlvbihjb21wb25lbnQpew0KICAgICAgICAgICAgICB2YXIgcHJvcGVydGllcyA9IGNvbXBvbmVudC5kYXRhKCJwcm9wZXJ0aWVzIiksDQogICAgICAgICAgICAgICAgY29tcG9uZW50ID0gY29tcG9uZW50LmZpbmQoIi5jYXJvdXNlbC1pbm5lciIpLA0KICAgICAgICAgICAgICAgIGlkID0gY29tcG9uZW50LmF0dHIoImRhdGEtaWQiKSwNCiAgICAgICAgICAgICAgICBzZWxmID0gY29tcG9uZW50LmVxKDApLA0KICAgICAgICAgICAgICAgIHF1ZXJ5U2xpZGVJbmRleCA9IHBhcnNlSW50KFhBLnF1ZXJ5U3RyaW5nLmdldFF1ZXJ5UGFyYW0oY29tcG9uZW50LmNsb3Nlc3QoJy5jb21wb25lbnQuY2Fyb3VzZWwnKS5hdHRyKCJpZCIpIHx8ICJjYXJvdXNlbCIpKSwNCiAgICAgICAgICAgICAgICB2YWxpZFF1ZXJ5UGFyYW0gPSB0eXBlb2YgcXVlcnlTbGlkZUluZGV4ICE9PSAidW5kZWZpbmVkIiAmJiAhaXNOYU4ocXVlcnlTbGlkZUluZGV4KSAmJiBxdWVyeVNsaWRlSW5kZXggPCBjb21wb25lbnQuZmluZCgiLnN4YS1udW1iZXJzIikubGVuZ3RoLA0KICAgICAgICAgICAgICAgIGNvbnRleHQsIHNldHRpbmdzLCAkY3VycmVudFNsaWRlLCAkc2xpZGVzOw0KDQogICAgICAgICAgICBpZiAocHJvcGVydGllcykgew0KICAgICAgICAgICAgICAgIGlmICghcHJvcGVydGllcy5uYXZpZ2F0aW9uKSB7DQogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXMubmF2aWdhdGlvbiA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IHt9LA0KICAgICAgICAgICAgICAgICAgICAgICAgcHJldkl0ZW06IHt9LA0KICAgICAgICAgICAgICAgICAgICAgICAgbmV4dEl0ZW06IHt9LA0KICAgICAgICAgICAgICAgICAgICAgICAgaXNFbmFibGVkOiB2YWxpZFF1ZXJ5UGFyYW0gPyBmYWxzZTogdHJ1ZQ0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLm5hdmlnYXRpb24uaXRlbS5zZWxlY3RvciA9ICJbZGF0YS1pZD0nIiArIGlkICsgIiddIC5uYXYtaXRlbXMiOyAvL3Byb3BlcnRpZXMubmF2aWdhdGlvbi5pdGVtLnNlbGVjdG9yOw0KICAgICAgICAgICAgICAgIHByb3BlcnRpZXMubmF2aWdhdGlvbi5wcmV2SXRlbS5zZWxlY3RvciA9ICIjIiArIGlkICsgIiAubmF2IjsNCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLm5hdmlnYXRpb24ubmV4dEl0ZW0uc2VsZWN0b3IgPSAiIyIgKyBpZCArICIgLm5hdiI7DQoNCiAgICAgICAgICAgICAgICB2YXIgY2Fyb3VzZWwgPSBuZXcgQ2Fyb3VzZWwoJCk7DQogICAgICAgICAgICAgICAgY2Fyb3VzZWwuaW5pdChjb21wb25lbnQsIHByb3BlcnRpZXMpOw0KDQogICAgICAgICAgICAgICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgIGNhcm91c2VsLnJlc2l6ZVdyYXBwZXIoKTsNCiAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgIGlmICh2YWxpZFF1ZXJ5UGFyYW0pIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dCA9IGNhcm91c2VsLnNsaWRlci5jb250ZXh0LA0KICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzLA0KICAgICAgICAgICAgICAgICAgICAkY3VycmVudFNsaWRlID0gY29udGV4dC5nZXRDdXJyZW50U2xpZGUoKSwNCiAgICAgICAgICAgICAgICAgICAgJHNsaWRlcyA9IGNvbnRleHQuJHNsaWRlczsNCg0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmNhbkNoYW5nZVNsaWRlID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLiRjdXJyZW50U2xpZGUgPSAkY3VycmVudFNsaWRlOw0KICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlID0gJCgkc2xpZGVzW3F1ZXJ5U2xpZGVJbmRleF0pOw0KDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuY2hhbmdlQ3VycmVudFNsaWRlKHNldHRpbmdzLiRuZXh0U2xpZGUpOw0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnRyYW5zaXRpb24ucGVyZm9ybShjb250ZXh0LnRyYW5zaXRpb25TZXR0aW5ncyk7DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQub3duZXIuZXhlY3V0ZU9uVGltZXJzKCdyZXNldCcsIGNvbnRleHQpOw0KDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQubmF2aWdhdGlvbi5wcmVwYXJlSXRlbXMocHJvcGVydGllcy5uYXZpZ2F0aW9uLml0ZW0sICRzbGlkZXMubGVuZ3RoLCAkKGNvbnRleHQuJHdyYXBwZXIpKTsNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5uYXZpZ2F0aW9uLnNlbGVjdEl0ZW0ocXVlcnlTbGlkZUluZGV4KTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjYXJvdXNlbC5zd2lwZVNsaWRlKCk7ICAgDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgIH0NCg0KDQogICAgcHViLmluaXQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICQoIi5jYXJvdXNlbDpub3QoLmluaXRpYWxpemVkKSIpLmVhY2goZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcHViLmluaXRJbnN0YW5jZSgkKHRoaXMpKQ0KDQogICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCJpbml0aWFsaXplZCIpOw0KICAgICAgICB9KTsNCiAgICB9Ow0KDQogICAgcmV0dXJuIHB1YjsNCn0oalF1ZXJ5KSk7DQovKioNCiAqIGVuZCBvZiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzIG1vZHVsZS4NCiAqLw0KDQoNClhBLnJlZ2lzdGVyKCJjYXJvdXNlbHMiLCBYQS5jb21wb25lbnQuY2Fyb3VzZWxzKTsNCg0KDQoNClhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMgPSAoZnVuY3Rpb24oKSB7DQogICAgdmFyIHB1YiA9IHt9Ow0KDQogICAgLyoqDQogICAgICogVHJhbnNpdGlvblNldHRpbmdzIGNsYXNzIGhvbGRzIGRhdGEgbmVlZGVkIGZvciBjaGFuZ2luZyBzbGlkZXMNCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBUcmFuc2l0aW9uU2V0dGluZ3MoKSB7fQ0KICAgIC8qKg0KICAgICAqIEN1cnJlbnQgc2xpZGUgKGN1cnJlbnRseSBkaXNwbGF5ZWQpIGpRdWVyeSBvYmplY3QNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvblNldHRpbmdzDQogICAgICovDQogICAgVHJhbnNpdGlvblNldHRpbmdzLnByb3RvdHlwZS4kY3VycmVudFNsaWRlID0gbnVsbDsNCiAgICAvKioNCiAgICAgKiBOZXh0IHNsaWRlIGpRdWVyeSBvYmplY3QNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvblNldHRpbmdzDQogICAgICovDQogICAgVHJhbnNpdGlvblNldHRpbmdzLnByb3RvdHlwZS4kbmV4dFNsaWRlID0gbnVsbDsNCiAgICAvKioNCiAgICAgKiBBbGwgc2xpZGVzIChqUXVlcnkgb2JqZWN0KQ0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uU2V0dGluZ3MNCiAgICAgKi8NCiAgICBUcmFuc2l0aW9uU2V0dGluZ3MucHJvdG90eXBlLiRzbGlkZXMgPSBudWxsOw0KICAgIC8qKg0KICAgICAqIE9mZnNldCBiZXR3ZWVuICRjdXJyZW50U2xpZGUgYW5kICRuZXh0U2xpZGUNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvblNldHRpbmdzDQogICAgICovDQogICAgVHJhbnNpdGlvblNldHRpbmdzLnByb3RvdHlwZS5vZmZzZXQgPSAwOw0KICAgIC8qKg0KICAgICAqIENhbGxiYWNrIGZ1bmN0aW9uIHdoaWNoIG11c3QgYmUgY2FsbGVkIGFmdGVyIGFuaW1hdGlvbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvblNldHRpbmdzDQogICAgICovDQogICAgVHJhbnNpdGlvblNldHRpbmdzLnByb3RvdHlwZS5jYWxsYmFjayA9IG51bGw7DQogICAgLyoqDQogICAgICogZW5kIG9mIFRyYW5zaXRpb25TZXR0aW5ncyBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5UcmFuc2l0aW9uU2V0dGluZ3MgPSBUcmFuc2l0aW9uU2V0dGluZ3M7DQoNCiAgICAvKioNCiAgICAgKiBUcmFuc2l0aW9uIGNsYXNzIGlzIGEgYmFzZSBjbGFzcyBvZiBhbGwgdHJhbnNpdGlvbnMuDQogICAgICoNCiAgICAgKiBJbXBvcnRhbnQ6IHNldHRpbmdzLmNhbGxiYWNrKCkgKEBzZWUgVHJhbnNpdGlvblNldHRpbmdzKSBoYXZlIHRvIGJlIGNhbGxlZCBhdCB0aGUgZW5kIG9mIGV4ZWN1dGlvbiB0aGUgcGVyZm9ybSgpIG1ldGhvZC4NCiAgICAgKg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFRyYW5zaXRpb24oKSB7fQ0KICAgIFRyYW5zaXRpb24ucHJvdG90eXBlID0gbmV3IFRyYW5zaXRpb24oKTsNCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyBhIHRyYW5zaXRpb24gd2l0aCBnaXZlbiBzZXR0aW5ncyAoQHNlZSBUcmFuc2l0aW9uU2V0dGluZ3MpLg0KICAgICAqIA0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvbg0KICAgICAqIEBwYXJhbSB7VHJhbnNpdGlvblNldHRpbmdzfSBzZXR0aW5ncyAgdHJhbnNpdGlvbiBzZXR0aW5ncw0KICAgICAqLw0KICAgIC8qIGVzbGludC1kaXNhYmxlICovDQogICAgVHJhbnNpdGlvbi5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKHNldHRpbmdzKSB7DQogICAgICAgIC8vaW1wbGVtZW50YXRpb24gdXNpbmcgc2V0dGluZ3MNCiAgICB9Ow0KICAgIC8qIGVzbGludC1lbmFibGUgKi8NCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIGEgZmFjdG9yIGFzc29jaWF0ZWQgd2l0aCBzZXR0aW5ncy5vZmZzZXQgKEBzZWUgVHJhbnNpdGlvblNldHRpbmdzKSwgd2hpY2gNCiAgICAgKiBjYW4gYmUgdXNlZnVsbCBmb3Igc29tZSBhbmltYXRpb25zLg0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uDQogICAgICogQHBhcmFtIHtUcmFuc2l0aW9uU2V0dGluZ3N9IHNldHRpbmdzICB0cmFuc2l0aW9uIHNldHRpbmdzDQogICAgICogQHJldHVybiBUaGUgZmFjdG9yOyAxIGlmIG9mZnNldCBpcyBoaWdoZXIgdGhhbiAwLCAtMSBvdGhlcndpc2UNCiAgICAgKiBAdHlwZSBOdW1iZXINCiAgICAgKi8NCiAgICBUcmFuc2l0aW9uLnByb3RvdHlwZS5mYWN0b3IgPSBmdW5jdGlvbihzZXR0aW5ncykgew0KICAgICAgICByZXR1cm4gKHNldHRpbmdzLm9mZnNldCA+IDApID8gMSA6IC0xOw0KICAgIH07DQogICAgLyoqDQogICAgICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIHVzZWQgYnkgY2Fyb3VzZWxzIHRvIGNoYW5nZSBzbGlkZXMuDQogICAgICoNCiAgICAgKiBJbXBvcnRhbnQ6IHNldHRpbmdzLmNhbGxiYWNrKCkgKEBzZWUgVHJhbnNpdGlvblNldHRpbmdzKSBoYXZlIHRvIGJlIGNhbGxlZCBhdCB0aGUgZW5kIG9mIHRoaXMgbWV0aG9kIGV4ZWN1dGlvbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvbg0KICAgICAqIEBwYXJhbSB7VHJhbnNpdGlvblNldHRpbmdzfSBzZXR0aW5ncyAgdHJhbnNpdGlvbiBzZXR0aW5ncw0KICAgICAqLw0KICAgIFRyYW5zaXRpb24ucHJvdG90eXBlLnBlcmZvcm0gPSBmdW5jdGlvbihzZXR0aW5ncykgew0KICAgICAgICBzZXR0aW5ncy5jYWxsYmFjaygpOw0KICAgIH07DQogICAgLyoqDQogICAgICogRW5kIG9mIFRyYW5zaXRpb24gY2xhc3MNCiAgICAgKi8NCiAgICBwdWIuVHJhbnNpdGlvbiA9IFRyYW5zaXRpb247DQoNCiAgICAvKioNCiAgICAgKiBCYXNpY1RyYW5zaXRpb24gY2xhc3MgY2hhbmdlcyBzbGlkZXMgd2l0aG91dCBhbnkgYW5pbWF0aW9uLg0KICAgICAqIERvIG5vdCByZW1vdmUgdGhpcyBjbGFzcywgYmVjYW91c2UgY2Fyb3VzZWxzIHdpbGwgdXNlIGl0IGJ5IGRlZmF1bHQsDQogICAgICogaWYgcmVxdWVzdGVkIHRyYW5zaXRpb24gY2Fubm90IGJlIGZvdW5kLg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIEJhc2ljVHJhbnNpdGlvbigpIHt9DQogICAgQmFzaWNUcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBUcmFuc2l0aW9uKCk7DQogICAgQmFzaWNUcmFuc2l0aW9uLmNvbnN0cnVjdG9yID0gQmFzaWNUcmFuc2l0aW9uOw0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgQmFzaWNUcmFuc2l0aW9uDQogICAgICovDQogICAgQmFzaWNUcmFuc2l0aW9uLnByb3RvdHlwZS5wZXJmb3JtID0gZnVuY3Rpb24oc2V0dGluZ3MpIHsNCiAgICAgICAgc2V0dGluZ3MuJGN1cnJlbnRTbGlkZS5oaWRlKCk7DQogICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuc2hvdygpOw0KDQogICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBFbmQgb2YgQmFzaWNUcmFuc2l0aW9uIGNsYXNzDQogICAgICovDQogICAgcHViLkJhc2ljVHJhbnNpdGlvbiA9IEJhc2ljVHJhbnNpdGlvbjsNCg0KICAgIC8qKg0KICAgICAqIEZhZGVJblRyYW5zaXRpb24gY2xhc3MgY2hhbmdlcyBzbGlkZXMgYnkgZmFkaW5nIGluIG5ldyBzbGlkZS4NCiAgICAgKiBUaGlzIGNsYXNzIGNhbiBiZSByZW1vdmVkIGlmIGVmZmVjdCBpcyBub3QgdXNlZC4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBGYWRlSW5UcmFuc2l0aW9uKCkge30NCiAgICBGYWRlSW5UcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBUcmFuc2l0aW9uKCk7DQogICAgRmFkZUluVHJhbnNpdGlvbi5jb25zdHJ1Y3RvciA9IEZhZGVJblRyYW5zaXRpb247DQogICAgLyoqDQogICAgICogQG1lbWJlciBGYWRlSW5UcmFuc2l0aW9uDQogICAgICovDQogICAgRmFkZUluVHJhbnNpdGlvbi5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAvKnNldHRpbmdzLiRzbGlkZXMuY3NzKHsNCiAgICAgICAgICdwb3NpdGlvbic6ICdhYnNvbHV0ZScsDQogICAgICAgICAndG9wJzogJzBweCcsDQogICAgICAgICAnbGVmdCc6ICcwcHgnDQogICAgICAgICB9KTsqLw0KICAgIH07DQogICAgLyoqDQogICAgICogQG1lbWJlciBGYWRlSW5UcmFuc2l0aW9uDQogICAgICovDQogICAgRmFkZUluVHJhbnNpdGlvbi5wcm90b3R5cGUucGVyZm9ybSA9IGZ1bmN0aW9uKHNldHRpbmdzKSB7DQogICAgICAgIHZhciB6SW5kZXhBdHRyaWIgPSAnei1pbmRleCcsDQogICAgICAgICAgICAkcGFyZW50ID0gc2V0dGluZ3MuJHNsaWRlcy5wYXJlbnQoKSwNCiAgICAgICAgICAgICRuZXh0U2xpZGUgPSBzZXR0aW5ncy4kbmV4dFNsaWRlOw0KDQogICAgICAgICRwYXJlbnQuY3NzKHpJbmRleEF0dHJpYiwgMCk7DQogICAgICAgICRuZXh0U2xpZGUuY3NzKHpJbmRleEF0dHJpYiwgMSk7DQogICAgICAgIHNldHRpbmdzLiRzbGlkZXMuY3NzKHsNCiAgICAgICAgICAgICdwb3NpdGlvbic6ICdyZWxhdGl2ZScNCiAgICAgICAgfSk7DQoNCiAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5jc3Moew0KICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJywNCiAgICAgICAgICAgICd0b3AnOiAnMCcsDQogICAgICAgICAgICAnYm90dG9tJzogJzAnLA0KICAgICAgICAgICAgJ2xlZnQnOiAnMCcsDQogICAgICAgICAgICAncmlnaHQnOiAnMCcNCiAgICAgICAgfSk7DQoNCg0KICAgICAgICAkbmV4dFNsaWRlLmZhZGVJbihmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIHNldHRpbmdzLiRjdXJyZW50U2xpZGUuaGlkZSgpOw0KDQogICAgICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7DQogICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ3JlbGF0aXZlJywNCiAgICAgICAgICAgICAgICAnbGVmdCc6ICcwJywNCiAgICAgICAgICAgICAgICAndHJhbnNmb3JtJzogJ25vbmUnDQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgJG5leHRTbGlkZS5jc3MoekluZGV4QXR0cmliLCAnJyk7DQogICAgICAgICAgICAkcGFyZW50LmNzcyh6SW5kZXhBdHRyaWIsICcnKTsNCg0KICAgICAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soKTsNCiAgICAgICAgfSk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBFbmQgb2YgRmFkZUluVHJhbnNpdGlvbiBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5GYWRlSW5UcmFuc2l0aW9uID0gRmFkZUluVHJhbnNpdGlvbjsNCg0KICAgIC8qKg0KICAgICAqIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbiBjbGFzcyBjaGFuZ2VzIHNsaWRlcyBieSBzbGlkaW5nIHRoZW0gaG9yaXpvbnRhbGx5Lg0KICAgICAqIFRoaXMgY2xhc3MgY2FuIGJlIHJlbW92ZWQgaWYgZWZmZWN0IGlzIG5vdCB1c2VkLg0KICAgICAqIElmIG9mZnNldCAoZGlmZmVyZW5jZSBiZXR3ZWVuIGluZGV4IG9mIGN1cnJlbnRseSBkaXNwbGF5ZWQgc2xpZGUgYW5kIGluZGV4IG9mIHNsaWRlIHRoYXQgd2lsbCBiZSBzaG93bikNCiAgICAgKiBpcyBncmVhdGVyIHRoYW4gMCwgc2xpZGVzIGFyZSBzbGlkaW5nIHRvIHRoZSBsZWZ0LiBPdGhlcndpc2UgKG9mZnNldCBpcyBsb3dlciB0aGFuIDApLCBzbGlkZXMgYXJlIHNsaWRpbmcNCiAgICAgKiB0byB0aGUgbGVmdC4NCiAgICAgKiBXaGVuIHNsaWRlIGNoYW5nZSBpcyByYWlzZWQgYXV0b21hdGljYWxseSwgc2xpZGVzIGFyZSBhbHdheXMgc2xpZGluZyB0byByaWdodCAob2Zmc2V0ID09IDEpLg0KICAgICAqIElmIHVzZXIgcmFpc2VzIHNsaWRlcyBjaGFuZ2UsIHNsaWRlcyBhcmUgc2xpZGluZzoNCiAgICAgKiAtIHRvIGxlZnQsIGlmIG9mZnNldCBpcyBncmVhdGVyIHRoYW4gMCAoc2xpZGUgd2l0aCBoaWdoZXIgaW5kZXggd2lsbCBiZSBzaG93biBvciB1c2VyIGNsaWNrcyBvbiAnbmV4dCcgbmF2aWdhdGlvbiBpdGVtKSwNCiAgICAgKiAtIHRvIHJpZ2h0LCBpZiBvZmZzZXQgaXMgbG93ZXIgdGhhbiAwIChzbGlkZSB3aXRoIGxvd2VyIGluZGV4IHdpbGwgYmUgc2hvd24gb3IgdXNlciBjbGlja3Mgb24gJ3ByZXYnIG5hdmlnYXRpb24gaXRlbSkuDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICovDQogICAgZnVuY3Rpb24gU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uKCkge30NCiAgICBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24ucHJvdG90eXBlID0gbmV3IFRyYW5zaXRpb24oKTsNCiAgICBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24uY29uc3RydWN0b3IgPSBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb247DQogICAgLyoqDQogICAgICogQG1lbWJlciBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24NCiAgICAgKi8NCiAgICBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24ucHJvdG90eXBlLm9uQW5pbWF0aW9uQ29tcGxldGUgPSBmdW5jdGlvbihzZXR0aW5ncywgJHBhcmVudCkgew0KICAgICAgICBzZXR0aW5ncy4kY3VycmVudFNsaWRlLmhpZGUoKTsNCiAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5jc3Moew0KICAgICAgICAgICAgJ3RvcCc6ICcnLA0KICAgICAgICAgICAgJ2JvdHRvbSc6ICcnLA0KICAgICAgICAgICAgJ2xlZnQnOiAnJywNCiAgICAgICAgICAgICdwb3NpdGlvbic6ICcnLA0KICAgICAgICAgICAgJ3dpZHRoJzogJycNCiAgICAgICAgfSk7DQoNCiAgICAgICAgJHBhcmVudC5jc3Moew0KICAgICAgICAgICAgJ2xlZnQnOiAnJw0KICAgICAgICB9KTsNCg0KICAgICAgICAkcGFyZW50LmNzcygnbWFyZ2luLWxlZnQnLCAnJyk7DQoNCiAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uDQogICAgICovDQogICAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLnByb3RvdHlwZS5wZXJmb3JtID0gZnVuY3Rpb24gKHNldHRpbmdzLCBvZmZzZXQpIHsNCiAgICAgICAgdmFyIGZhY3RvciA9IHRoaXMuZmFjdG9yKHNldHRpbmdzKSwNCiAgICAgICAgICAgIG9uQW5pbWF0aW9uQ29tcGxldGUgPSB0aGlzLm9uQW5pbWF0aW9uQ29tcGxldGUsDQogICAgICAgICAgICB3aWR0aCA9IHNldHRpbmdzLiRjdXJyZW50U2xpZGUud2lkdGgoKSwNCiAgICAgICAgICAgICRwYXJlbnQgPSBzZXR0aW5ncy4kc2xpZGVzLnBhcmVudCgpOw0KDQogICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsNCiAgICAgICAgICAgICd0b3AnOiAnMCcsDQogICAgICAgICAgICAnYm90dG9tJzogJzAnLA0KICAgICAgICAgICAgJ2xlZnQnOiAnMTAwJScsDQogICAgICAgICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLA0KICAgICAgICAgICAgJ3dpZHRoJzogJzEwMCUnDQogICAgICAgIH0pOw0KICAgICAgICBpZiAob2Zmc2V0ID4gMCkgew0KICAgICAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5jc3Moew0KICAgICAgICAgICAgICAgICdsZWZ0JzogJzEwMCUnLA0KICAgICAgICAgICAgfSkNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsNCiAgICAgICAgICAgICAgICAnbGVmdCc6ICctMTAwJScsDQogICAgICAgICAgICB9KQ0KICAgICAgICB9DQogICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuc2hvdygpOw0KICAgICAgICAkcGFyZW50LmFuaW1hdGUoew0KICAgICAgICAgICAgJ2xlZnQnOiAtZmFjdG9yICogd2lkdGggKyAncHgnLA0KICAgICAgICB9LCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIG9uQW5pbWF0aW9uQ29tcGxldGUoc2V0dGluZ3MsICRwYXJlbnQpOw0KICAgICAgICB9KTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEVuZCBvZiBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24gY2xhc3MNCiAgICAgKi8NCiAgICBwdWIuU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uID0gU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uOw0KDQogICAgLyoqDQogICAgICogU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbiBjbGFzcyBjaGFuZ2VzIHNsaWRlcyBieSBzbGlkaW5nIHRoZW0gdmVydGljYWxseS4NCiAgICAgKiBUaGlzIGNsYXNzIGNhbiBiZSByZW1vdmVkIGlmIHRoaXMgZWZmZWN0IGlzIG5vdCB1c2VkLg0KICAgICAqIElmIG9mZnNldCAoZGlmZmVyZW5jZSBiZXR3ZWVuIGluZGV4IG9mIGN1cnJlbnRseSBkaXNwbGF5ZWQgc2xpZGUgYW5kIGluZGV4IG9mIHNsaWRlIHRoYXQgd2lsbCBiZSBzaG93bikNCiAgICAgKiBpcyBncmVhdGVyIHRoYW4gMCwgc2xpZGVzIGFyZSBzbGlkaW5nIGZyb20gdXAgdG8gZG93bi4gT3RoZXJ3aXNlIChvZmZzZXQgaXMgbG93ZXIgdGhhbiAwKSwgc2xpZGVzIGFyZSBzbGlkaW5nDQogICAgICogZnJvbSBkb3duIHRvIHVwLg0KICAgICAqIFdoZW4gc2xpZGUgY2hhbmdlIGlzIHJhaXNlZCBhdXRvbWF0aWNhbGx5LCBzbGlkZXMgYXJlIGFsd2F5cyBzbGlkaW5nIGZyb20gdXAgdG8gZG93biAob2Zmc2V0ID09IDEpLg0KICAgICAqIElmIHVzZXIgcmFpc2VzIHNsaWRlcyBjaGFuZ2UsIHNsaWRlcyBhcmUgc2xpZGluZzoNCiAgICAgKiAtIGZyb20gdXAgdG8gZG93biwgaWYgb2Zmc2V0IGlzIGdyZWF0ZXIgdGhhbiAwIChzbGlkZSB3aXRoIGhpZ2hlciBpbmRleCB3aWxsIGJlIHNob3duIG9yIHVzZXIgY2xpY2tzIG9uICduZXh0JyBuYXZpZ2F0aW9uIGl0ZW0pLA0KICAgICAqIC0gZnJvbSBkb3duIHRvIHVwLCBpZiBvZmZzZXQgaXMgbG93ZXIgdGhhbiAwIChzbGlkZSB3aXRoIGxvd2VyIGluZGV4IHdpbGwgYmUgc2hvd24gb3IgdXNlciBjbGlja3Mgb24gJ3ByZXYnIG5hdmlnYXRpb24gaXRlbSkuDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICovDQogICAgZnVuY3Rpb24gU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbigpIHt9DQogICAgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbi5wcm90b3R5cGUgPSBuZXcgVHJhbnNpdGlvbigpOw0KICAgIFNsaWRlVmVydGljYWxseVRyYW5zaXRpb24uY29uc3RydWN0b3IgPSBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uOw0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbg0KICAgICAqLw0KICAgIFNsaWRlVmVydGljYWxseVRyYW5zaXRpb24ucHJvdG90eXBlLm9uQW5pbWF0aW9uQ29tcGxldGUgPSBmdW5jdGlvbihzZXR0aW5ncywgJHBhcmVudCkgew0KICAgICAgICBzZXR0aW5ncy4kY3VycmVudFNsaWRlLmhpZGUoKTsNCiAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5jc3Moew0KICAgICAgICAgICAgJ3RvcCc6ICcnLA0KICAgICAgICAgICAgJ2JvdHRvbSc6ICcnLA0KICAgICAgICAgICAgJ2xlZnQnOiAnJywNCiAgICAgICAgICAgICdyaWdodCc6ICcnLA0KICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJycsDQogICAgICAgICAgICAnd2lkdGgnOiAnJw0KICAgICAgICB9KTsNCg0KCQkkcGFyZW50LmNzcygndG9wJywgJycpOw0KICAgICAgICAkcGFyZW50LmNzcygnbWFyZ2luLXRvcCcsICcnKTsNCg0KICAgICAgICBzZXR0aW5ncy5jYWxsYmFjaygpOw0KICAgIH07DQogICAgLyoqDQogICAgICogQG1lbWJlciBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uDQogICAgICovDQogICAgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbi5wcm90b3R5cGUucGVyZm9ybSA9IGZ1bmN0aW9uIChzZXR0aW5ncywgb2Zmc2V0KSB7DQogICAgICAgIHZhciBmYWN0b3IgPSB0aGlzLmZhY3RvcihzZXR0aW5ncyksDQogICAgICAgICAgICBvbkFuaW1hdGlvbkNvbXBsZXRlID0gdGhpcy5vbkFuaW1hdGlvbkNvbXBsZXRlLA0KICAgICAgICAgICAgaGVpZ2h0ID0gc2V0dGluZ3MuJGN1cnJlbnRTbGlkZS5oZWlnaHQoKSwNCiAgICAgICAgICAgICRwYXJlbnQgPSBzZXR0aW5ncy4kc2xpZGVzLnBhcmVudCgpOw0KDQogICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsNCiAgICAgICAgICAgICdsZWZ0JzogJzAnLA0KICAgICAgICAgICAgJ3JpZ2h0JzogJzAnLA0KICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJywNCiAgICAgICAgICAgICd3aWR0aCc6ICcxMDAlJw0KICAgICAgICB9KTsNCiAgICAgICAgaWYgKG9mZnNldCA+IDApIHsNCiAgICAgICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsNCiAgICAgICAgICAgICAgICAndG9wJzogJy0xMDAlJywNCiAgICAgICAgICAgICAgICAnYm90dG9tJzogJzEwMCUnLA0KICAgICAgICAgICAgfSkNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsNCiAgICAgICAgICAgICAgICAndG9wJzogJzEwMCUnLA0KICAgICAgICAgICAgICAgICdib3R0b20nOiAnLTEwMCUnLA0KICAgICAgICAgICAgfSkNCiAgICAgICAgfQ0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLnNob3coKTsNCg0KICAgICAgICAkcGFyZW50LmFuaW1hdGUoew0KICAgICAgICAgICAgJ3RvcCc6IGZhY3RvciAqIGhlaWdodA0KICAgICAgICB9LCBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIG9uQW5pbWF0aW9uQ29tcGxldGUoc2V0dGluZ3MsICRwYXJlbnQpOw0KICAgICAgICB9KTsNCg0KICAgIH07DQogICAgLyoqDQogICAgICogU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbiBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5TbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uID0gU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbjsNCg0KICAgIHJldHVybiBwdWI7DQp9KGpRdWVyeSkpOw0KLyoqDQogKiBlbmQgb2YgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucyBtb2R1bGUuDQogKi8NCg0KLyoqDQogKiBYQUNvbnRleHQNCiAqDQogKiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzIG1vZHVsZS4NCiAqDQogKiBFeHBvc2VzIFZpZXcgY2xhc3MsIHdoaWNoIGlzIGEgYmFzZSBjbGFzcyBvZiBhbGwgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3cyB1c2VkIGJ5IGNhcm91c2VscyAoQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLCBAc2VlIFZpZXcpLg0KICogQWxzbyBleHBvc2VzIGltcGxlbWVudGF0aW9uIG9mIHRoZXNlICd0aW1lIGluZGljYXRvcicgdmlld3M6DQogKiAtIFByb2dyZXNzQmFyVmlldyAtIHNob3dzIHRoZSBwcm9ncmVzcyBvZiB0aW1lLCB0aGF0IGxvb2tzIGxpa2UgYSBwcm9ncmVzcyBiYXIsDQogKiAtIFJvdGF0b3JWaWV3IC0gc2hvd3MgdGhlIHByb2dyZXNzIG9mIHRpbWUgd2l0aCB0aGUgZmlsbGluZyB1cCByaW5nLg0KICogQ2Fyb3VzZWwgdGFrZXMgdGhlIGNsYXNzIGNvbnN0cnVjdG9yIGJ5IG5hbWUgZnJvbSB0aGlzIG1vZHVsZSAoaXQgaXMgZ2l2ZW4gaW4gb3B0aW9ucyBvYmplY3Qgb2YgY2Fyb3VzZWw7IEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2VscykuDQogKiBJZiB0aGVyZSBpcyBhIG5lZWQgdG8gaW1wbGVtZW50IHRoZSBuZXcgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3LCBjcmVhdGUgYSBuZXcgY2xhc3MsDQogKiBieSBpbmhlcml0aW5nIGZyb20gVmlldyBjbGFzcyBhbmQgYWRkIGl0IHRvIHRoaXMgbW9kdWxlLiBEdXJpbmcgaW1wbGVtZW50YXRpb24gb2YgYSBuZXcgJ3RpbWUgaW5kaWNhdG9yJw0KICogdmlldyB0aGUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JzVmlldy5Ub29scyBuYW1lc3BhY2UgbWF5IGJlIHVzZWZ1bGwuIEl0IGNvbnRhaW5zOg0KICogLSBpc0Nzc1N1cHBvcnRlZChwcm9wcykgZnVuY3Rpb24sIHdoaWNoIGNoZWNrcyBpZiBhbnkgb2YgQ1NTIHByb3BlcnRpZXMgaXMgc3VwcG9ydGVkIChwcm9wcyAtIGFycmF5IG9mIHByb3BlcnRpZXMpLA0KICogLSBpc1RyYW5zZm9ybVN1cHBvcnRlZCgpIGZ1bmN0aW9uLCB3aGljaCBjaGVja3MgaWYgQ1NTIDMgJ3RyYW5zZm9ybScgaXMgc3VwcG9ydGVkLg0KICoNCiAqIEV4YW1wbGUgdmlldyBpbXBsZW1lbnRhdGlvbiAob3BhY2l0eSBpbmNyZWFzZXMgd2l0aCBhIHByb2dyZXNzIG9mIHRoZSB0aW1lKToNCiAqIChmdW5jdGlvbigpIHsNCiAqICAgICB2YXIgVmlldyA9IFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MuVmlldzsNCiAqDQogKiAgICAgZnVuY3Rpb24gU2FtcGxlVmlldyAoc2VsZWN0b3IsIG9wdGlvbnMpIHsNCiAqICAgICAgICAgLy9iYXNlIGNvbnN0cnVjdG9yIGhhdmUgdG8gYmUgY2FsbGVkDQogKiAgICAgICAgIFZpZXcuY2FsbCh0aGlzLCBzZWxlY3Rvcik7DQogKiAgICAgfQ0KICoNCiAqICAgICBTYW1wbGVWaWV3LnByb3RvdHlwZSA9IG5ldyBWaWV3KCk7DQogKiAgICAgU2FtcGxlVmlldy5jb25zdHJ1Y3RvciA9IFNhbXBsZVZpZXc7DQogKg0KICogICAgIFNhbXBsZVZpZXcucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAodGltZW91dCkgew0KICogICAgICAgICAvL2Jhc2UgbWV0aG9kIGhhdmUgdG8gYmUgY2FsbGVkDQogKiAgICAgICAgIFZpZXcucHJvdG90eXBlLmluaXQuY2FsbCh0aGlzLCB0aW1lb3V0KTsNCiAqDQogKiAgICAgICAgIC8vaW5pdGlhbGl6YXRpb24gY29kZSAtIG5vdCBuZWVkZWQgaW4gdGhpcyBleGFtcGxlDQogKiAgICAgfTsNCiAqDQogKiAgICAgU2FtcGxlVmlldy5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7DQogKiAgICAgICAgIC8vYmFzZSBtZXRob2QgaGF2ZSB0byBiZSBjYWxsZWQNCiAqICAgICAgICAgVmlldy5wcm90b3R5cGUucmVzZXQuY2FsbCh0aGlzKTsNCiAqDQogKiAgICAgICAgIC8vcmVzZXRpbmcgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3DQogKiAgICAgICAgIHRoaXMuJGluZGljYXRvci5zdG9wKHRydWUpOw0KICogICAgICAgICB0aGlzLiRpbmRpY2F0b3IuY3NzKCdvcGFjaXR5JywgMCk7DQogKiAgICAgfTsNCiAqDQogKiAgICAgU2FtcGxlVmlldy5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbiAoKSB7DQogKiAgICAgICAgIC8vc3RvcGluZyAndGltZSBpbmRpY2F0b3InIHZpZXcgYW5pbWF0aW9uDQogKiAgICAgICAgIHRoaXMuJGluZGljYXRvci5zdG9wKHRydWUpOw0KICogICAgIH07DQogKg0KICogICAgIFNhbXBsZVZpZXcucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbiAoKSB7DQogKiAgICAgICAgIC8vc3RhcnRpbmcvcmVzdW1pbmcgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3IGFuaW1hdGlvbg0KICogICAgICAgICB0aGlzLiRpbmRpY2F0b3IuYW5pbWF0ZSh7DQogKiAgICAgICAgICAgICAnb3BhY2l0eSc6IDENCiAqICAgICAgICAgfSwgdGhpcy50aW1lb3V0IC0gdGhpcy50aW1lRWxhcHNlZCwgJ2xpbmVhcicpOw0KICogICAgIH07DQogKg0KICogICAgIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MuU2FtcGxlVmlldyA9IFNhbXBsZVZpZXc7DQogKiB9KCkpOw0KICoNCiAqLw0KWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cyA9IChmdW5jdGlvbigkKSB7DQogICAgdmFyIHB1YiA9IHt9LA0KICAgICAgICBzdXBwb3J0RWxlbWVudFN0eWxlID0gbnVsbDsNCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiBhbnkgb2YgQ1NTIHByb3BlcnRpZXMgaXMgc3VwcG9ydGVkLg0KICAgICAqDQogICAgICogQHBhcmFtIHtBcnJheX0gcHJvcHMgICAgIGFycmF5IG9mIHByb3BlcnRpZXMgdG8gYmUgY2hlY2tlZA0KICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBhbnkgb2YgQ1NTIHByb3BlcnRpZXMgaXMgc3VwcG9ydGVkLCBmYWxzZSBvdGhlcndpc2UNCiAgICAgKiBAdHlwZSBCb29sZWFuDQogICAgICovDQogICAgZnVuY3Rpb24gaXNDc3NTdXBwb3J0ZWQocHJvcHMpIHsNCiAgICAgICAgdmFyIGksDQogICAgICAgICAgICBpc1N1cHBvcnRlZCA9IGZhbHNlOw0KDQogICAgICAgIGlmIChzdXBwb3J0RWxlbWVudFN0eWxlID09PSBudWxsKSB7DQogICAgICAgICAgICBzdXBwb3J0RWxlbWVudFN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3VwcG9ydEVsZW1lbnQnKS5zdHlsZTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZvciAoaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgaWYgKHN1cHBvcnRFbGVtZW50U3R5bGVbcHJvcHNbaV1dICE9PSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICBpc1N1cHBvcnRlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gaXNTdXBwb3J0ZWQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIENTUyAzICd0cmFuc2Zvcm0nIGlzIHN1cHBvcnRlZC4NCiAgICAgKg0KICAgICAqIEByZXR1cm4gdHJ1ZSBpZiBDU1MgMyAndHJhbnNmb3JtJyBpcyBzdXBwb3J0ZWQsIGZhbHNlIG90aGVyd2lzZQ0KICAgICAqIEB0eXBlIEJvb2xlYW4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc1RyYW5zZm9ybVN1cHBvcnRlZCgpIHsNCiAgICAgICAgcmV0dXJuIGlzQ3NzU3VwcG9ydGVkKFsndHJhbnNmb3JtUHJvcGVydHknLCAnV2Via2l0VHJhbnNmb3JtJywgJ01velRyYW5zZm9ybScsICdPVHJhbnNmb3JtJywgJ21zVHJhbnNmb3JtJ10pOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MuVG9vbHMgbmFtZXNwYWNlDQogICAgICoNCiAgICAgVGhpcyBuYW1lc3BhY2UgY2FuIGJlIHJlbW92ZWQgaWYgUm90YXRvclZpZXcgY2xhc3MgaXMgbm90IHVzZWQgKEBzZWUgUm90YXRvclZpZXcpDQogICAgICovDQogICAgcHViLlRvb2xzID0ge307DQogICAgcHViLlRvb2xzLmlzQ3NzU3VwcG9ydGVkID0gaXNDc3NTdXBwb3J0ZWQ7DQogICAgcHViLlRvb2xzLmlzVHJhbnNmb3JtU3VwcG9ydGVkID0gaXNUcmFuc2Zvcm1TdXBwb3J0ZWQ7DQogICAgLyoqDQogICAgICogRW5kIG9mIG5hbWVzcGFjZQ0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogVmlldyBjbGFzcyBpcyBhIGJhc2UgY2xhc3Mgb2YgYWxsICd0aW1lIGluZGljYXRvcicgdmlld3MNCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3IgYSBzZWxlY3RvciB1c2VkIGZvciBzZWFyY2hpbmcNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAgIFZpZXcgb3B0aW9ucyBvYmplY3QNCiAgICAgKi8NCiAgICAvKiBlc2xpbnQtZGlzYWJsZSAqLw0KICAgIGZ1bmN0aW9uIFZpZXcoc2VsZWN0b3IsIG9wdGlvbnMpIHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIEEgalF1ZXJ5IG9iamVjdCBjb250YWluaW5nIGVsZW1lbnQsIHdoaWNoIHdpbGwgYmUgYW5pbWF0ZWQgdG8gc2hvdyBwb2dyZXNzIG9mIHRoZSB0aW1lLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFZpZXcNCiAgICAgICAgICovDQoNCiAgICAgICAgdGhpcy4kaW5kaWNhdG9yID0gJChzZWxlY3Rvcik7DQogICAgfQ0KICAgIC8qIGVzbGludC1lbmFibGUgKi8NCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyB0aGUgdmlldy4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVmlld2lvbg0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lb3V0ICAgYSB0aW1lb3V0IHRvIHRoZSBlbmQgb2Ygd2hvbGUgaW5kaWNhdG9yIGFuaW1hdGlvbg0KICAgICAqLw0KICAgIFZpZXcucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbih0aW1lb3V0KSB7DQogICAgICAgIHRoaXMudGltZUVsYXBzZWQgPSAwOw0KICAgICAgICB0aGlzLnRpbWVvdXQgPSB0aW1lb3V0Ow0KICAgIH07DQogICAgLyoqDQogICAgICogUmVzZXRzIHRoZSB2aWV3DQogICAgICoNCiAgICAgKiBAbWVtYmVyIFZpZXcNCiAgICAgKi8NCiAgICBWaWV3LnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB0aGlzLnRpbWVFbGFwc2VkID0gMDsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIFN0YXJ0cy9SZW5ld3MgdGhlIHZpZXcgYW5pbWF0aW9uLg0KICAgICAqDQogICAgICogQG1lbWJlciBWaWV3DQogICAgICovDQogICAgVmlldy5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKCkge307DQogICAgLyoqDQogICAgICogUGF1c2VzIHRoZSB2aWV3IGFuaW1hdGlvbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVmlldw0KICAgICAqLw0KICAgIFZpZXcucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24oKSB7fTsNCiAgICAvKioNCiAgICAgKiBVcGRhdGVzIHRoZSB0aW1lIHRoYXQgZWxhcHNlZCBzaW5jZSBhbmltYXRpb24gYmVnaW4uDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFZpZXcNCiAgICAgKi8NCiAgICBWaWV3LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbih0aW1lRWxhcHNlZCkgew0KICAgICAgICB0aGlzLnRpbWVFbGFwc2VkID0gdGltZUVsYXBzZWQ7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgVmlldyBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5WaWV3ID0gVmlldzsNCg0KICAgIC8qKg0KICAgICAqIFByb2dyZXNzQmFyVmlldyBjbGFzcyBwcm92aWRlcyBhIGxvZ2ljIGZvciBhbmltYXRlIGEgJ3RpbWUgaW5kaWNhdG9yJywNCiAgICAgKiB0aGF0IGxvb2tzIGxpa2UgcHJvZ3Jlc3MgYmFyLg0KICAgICAqDQogICAgICogT3B0aW9ucyBvYmplY3Q6DQogICAgICogew0KICAgICAqICAgICAnb3BhY2l0eSc6IE51bWJlciB2YWx1ZSAvL2JldHdlZW4gMCBhbmQgMTsgZGVmYXVsdCBpcyAwLjgNCiAgICAgKiB9DQogICAgICoNCiAgICAgKiBUaGlzIGNsYXNzIGNhbiBiZSByZW1vdmVkIGlmIHRoaXMga2luZCBvZiB2aWV3IGlzIG5vdCB1c2VkLg0KICAgICAqDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICogQHBhcmFtIHtTdHJpbmd9IHNlbGVjdG9yIGEgc2VsZWN0b3IgdXNlZCBmb3Igc2VhcmNoaW5nDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgICBWaWV3IG9wdGlvbnMgb2JqZWN0DQogICAgICovDQogICAgZnVuY3Rpb24gUHJvZ3Jlc3NCYXJWaWV3KHNlbGVjdG9yLCBvcHRpb25zKSB7DQogICAgICAgIFZpZXcuY2FsbCh0aGlzLCBzZWxlY3Rvcik7DQoNCiAgICAgICAgdmFyIGRlZmF1bHRzID0gew0KICAgICAgICAgICAgJ29wYWNpdHknOiAwLjgNCiAgICAgICAgfTsNCg0KICAgICAgICB0aGlzLnNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBvcHRpb25zKTsNCg0KICAgICAgICB0aGlzLiRjb250YWluZXIgPSB0aGlzLiRpbmRpY2F0b3I7DQogICAgICAgIHRoaXMuJGluZGljYXRvciA9IHRoaXMuJGluZGljYXRvci5maW5kKCdkaXYnKTsNCiAgICB9DQogICAgUHJvZ3Jlc3NCYXJWaWV3LnByb3RvdHlwZSA9IG5ldyBWaWV3KCk7DQogICAgUHJvZ3Jlc3NCYXJWaWV3LmNvbnN0cnVjdG9yID0gUHJvZ3Jlc3NCYXJWaWV3Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgUHJvZ3Jlc3NCYXJWaWV3DQogICAgICovDQogICAgUHJvZ3Jlc3NCYXJWaWV3LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24odGltZW91dCkgew0KICAgICAgICBWaWV3LnByb3RvdHlwZS5pbml0LmNhbGwodGhpcywgdGltZW91dCk7DQoNCiAgICAgICAgdmFyIG9wYWNpdHkgPSB0aGlzLnNldHRpbmdzLm9wYWNpdHk7DQogICAgICAgIHRoaXMuJGNvbnRhaW5lci5jc3MoJ29wYWNpdHknLCBvcGFjaXR5KTsNCiAgICAgICAgdGhpcy4kaW5kaWNhdG9yLmNzcygnb3BhY2l0eScsIG9wYWNpdHkpOw0KICAgIH07DQogICAgLyoqDQogICAgICogQG1lbWJlciBQcm9ncmVzc0JhclZpZXcNCiAgICAgKi8NCiAgICBQcm9ncmVzc0JhclZpZXcucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIFZpZXcucHJvdG90eXBlLnJlc2V0LmNhbGwodGhpcyk7DQoNCiAgICAgICAgdGhpcy4kaW5kaWNhdG9yLnN0b3AodHJ1ZSk7DQogICAgICAgIHRoaXMuJGluZGljYXRvci5jc3MoJ3dpZHRoJywgJzBweCcpOw0KICAgIH07DQogICAgLyoqDQogICAgICogQG1lbWJlciBQcm9ncmVzc0JhclZpZXcNCiAgICAgKi8NCiAgICBQcm9ncmVzc0JhclZpZXcucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHRoaXMuJGluZGljYXRvci5zdG9wKHRydWUpOw0KICAgIH07DQogICAgLyoqDQogICAgICogQG1lbWJlciBQcm9ncmVzc0JhclZpZXcNCiAgICAgKi8NCiAgICBQcm9ncmVzc0JhclZpZXcucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy4kaW5kaWNhdG9yLmFuaW1hdGUoew0KICAgICAgICAgICAgJ3dpZHRoJzogJzEwMCUnDQogICAgICAgIH0sIHRoaXMudGltZW91dCAtIHRoaXMudGltZUVsYXBzZWQsICdsaW5lYXInKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBQcm9ncmVzc0JhclZpZXcgY2xhc3MNCiAgICAgKi8NCiAgICBwdWIuUHJvZ3Jlc3NCYXJWaWV3ID0gUHJvZ3Jlc3NCYXJWaWV3Ow0KDQogICAgLyoqDQogICAgICogUm90YXRvclZpZXcgY2xhc3MgcHJvdmlkZXMgYSBsb2dpYyBmb3IgYW5pbWF0ZSBhICd0aW1lIGluZGljYXRvcicsDQogICAgICogdGhhdCBzaG93cyB0aGUgcHJvZ3Jlc3Mgb2YgdGltZSB3aXRoIHRoZSBmaWxsaW5nIHVwIHJpbmcNCiAgICAgKg0KICAgICAqIE9wdGlvbnMgb2JqZWN0Og0KICAgICAqIHsNCiAgICAgKiAgICAgJ29wYWNpdHknOiBOdW1iZXIgdmFsdWUgLy9iZXR3ZWVuIDAgYW5kIDE7IGRlZmF1bHQgaXMgMC41DQogICAgICogfQ0KICAgICAqDQogICAgICogVGhpcyBjbGFzcyBjYW4gYmUgcmVtb3ZlZCBpZiB0aGlzIGtpbmQgb2YgdmlldyBpcyBub3QgdXNlZC4NCiAgICAgKg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzZWxlY3RvciBhIHNlbGVjdG9yIHVzZWQgZm9yIHNlYXJjaGluZw0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zICAgVmlldyBvcHRpb25zIG9iamVjdA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFJvdGF0b3JWaWV3KHNlbGVjdG9yLCBvcHRpb25zKSB7DQogICAgICAgIFZpZXcuY2FsbCh0aGlzLCBzZWxlY3Rvcik7DQoNCiAgICAgICAgdmFyIGRlZmF1bHRzID0gew0KICAgICAgICAgICAgJ29wYWNpdHknOiAwLjUNCiAgICAgICAgfTsNCg0KICAgICAgICB0aGlzLnNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBvcHRpb25zKTsNCiAgICAgICAgdGhpcy4kbWFzayA9IHRoaXMuJGluZGljYXRvci5maW5kKCdzcGFuLm1hc2snKS5maXJzdCgpOw0KICAgICAgICB0aGlzLiRyb3RhdG9yID0gdGhpcy4kaW5kaWNhdG9yLmZpbmQoJ3NwYW4ucm90YXRvcicpLmZpcnN0KCk7DQoNCiAgICAgICAgZnVuY3Rpb24gcm90YXRlQ3NzKGRlZykgew0KICAgICAgICAgICAgdmFyIHZhbHVlID0gJ3JvdGF0ZSgnICsgZGVnICsgJ2RlZyknOw0KDQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICctd2Via2l0LXRyYW5zZm9ybSc6IHZhbHVlLA0KICAgICAgICAgICAgICAgICctbW96LXRyYW5zZm9ybSc6IHZhbHVlLA0KICAgICAgICAgICAgICAgICctby10cmFuc2Zvcm0nOiB2YWx1ZSwNCiAgICAgICAgICAgICAgICAnLW1zLXRyYW5zZm9ybSc6IHZhbHVlLA0KICAgICAgICAgICAgICAgICd0cmFuc2Zvcm0nOiB2YWx1ZQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGVSb3RhdG9yKCRyb3RhdG9yLCBvcHRpb25zKSB7DQogICAgICAgICAgICB2YXIgZGVmYXVsdHMgPSB7DQogICAgICAgICAgICAgICAgICAgICdmb250U2l6ZSc6ICcxODBweCcsDQogICAgICAgICAgICAgICAgICAgICdhbmltYXRlT3B0aW9ucyc6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICdzdGVwJzogZnVuY3Rpb24obm93KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvdGF0b3IuY3NzKHJvdGF0ZUNzcyhub3cpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAnZWFzaW5nJzogJ2xpbmVhcicNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgc2V0dGluZ3MgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMsIG9wdGlvbnMpOw0KDQogICAgICAgICAgICAkcm90YXRvci5hbmltYXRlKHsNCiAgICAgICAgICAgICAgICAgICAgJ2ZvbnQtc2l6ZSc6IHNldHRpbmdzLmZvbnRTaXplDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBzZXR0aW5ncy5hbmltYXRlT3B0aW9ucyk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBwaGFzZVR3b0FuaW1hdGlvbigkbWFzaywgJHJvdGF0b3IsIGR1cmF0aW9uKSB7DQogICAgICAgICAgICAkcm90YXRvci5hZGRDbGFzcygnaGFsZicpOw0KICAgICAgICAgICAgJG1hc2suYWRkQ2xhc3MoJ2hhbGYnKTsNCg0KICAgICAgICAgICAgYW5pbWF0ZVJvdGF0b3IoJHJvdGF0b3IsIHsNCiAgICAgICAgICAgICAgICAnZm9udFNpemUnOiAnMzYwcHgnLA0KICAgICAgICAgICAgICAgICdhbmltYXRlT3B0aW9ucyc6IHsNCiAgICAgICAgICAgICAgICAgICAgJ2R1cmF0aW9uJzogZHVyYXRpb24NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIHBoYXNlT25lQW5pbWF0aW9uKCRtYXNrLCAkcm90YXRvciwgZHVyYXRpb24sIHBoYXNlVHdvRHVyYXRpb24pIHsNCiAgICAgICAgICAgIGFuaW1hdGVSb3RhdG9yKCRyb3RhdG9yLCB7DQogICAgICAgICAgICAgICAgJ2FuaW1hdGVPcHRpb25zJzogew0KICAgICAgICAgICAgICAgICAgICAnZHVyYXRpb24nOiBkdXJhdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgJ2NvbXBsZXRlJzogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBwaGFzZVR3b0FuaW1hdGlvbigkbWFzaywgJHJvdGF0b3IsIHBoYXNlVHdvRHVyYXRpb24pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICB0aGlzLnJlc2V0Q3NzID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICB0aGlzLiRyb3RhdG9yLnJlbW92ZUNsYXNzKCdoYWxmJyk7DQogICAgICAgICAgICB0aGlzLiRyb3RhdG9yLmNzcyhyb3RhdGVDc3MoMCkpOw0KICAgICAgICAgICAgdGhpcy4kcm90YXRvci5jc3MoJ2ZvbnQtc2l6ZScsICcwcHgnKTsNCg0KICAgICAgICAgICAgdGhpcy4kbWFzay5yZW1vdmVDbGFzcygnaGFsZicpOw0KICAgICAgICB9Ow0KDQogICAgICAgIHRoaXMucGxheVBoYXNlT25lID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICB2YXIgZHVyYXRpb24gPSB0aGlzLnRpbWVvdXQgLyAyIC0gdGhpcy50aW1lRWxhcHNlZDsNCiAgICAgICAgICAgIHBoYXNlT25lQW5pbWF0aW9uKHRoaXMuJG1hc2ssIHRoaXMuJHJvdGF0b3IsIGR1cmF0aW9uLCB0aGlzLnRpbWVvdXQgLyAyKTsNCiAgICAgICAgfTsNCg0KICAgICAgICB0aGlzLnBsYXlQaGFzZVR3byA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgdmFyIGR1cmF0aW9uID0gdGhpcy50aW1lb3V0IC0gdGhpcy50aW1lRWxhcHNlZDsNCiAgICAgICAgICAgIHBoYXNlVHdvQW5pbWF0aW9uKHRoaXMuJG1hc2ssIHRoaXMuJHJvdGF0b3IsIGR1cmF0aW9uKTsNCiAgICAgICAgfTsNCiAgICB9DQogICAgUm90YXRvclZpZXcucHJvdG90eXBlID0gbmV3IFZpZXcoKTsNCiAgICBSb3RhdG9yVmlldy5jb25zdHJ1Y3RvciA9IFJvdGF0b3JWaWV3Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgUm90YXRvclZpZXcNCiAgICAgKi8NCiAgICBSb3RhdG9yVmlldy5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKHRpbWVvdXQpIHsNCiAgICAgICAgVmlldy5wcm90b3R5cGUuaW5pdC5jYWxsKHRoaXMsIHRpbWVvdXQpOw0KDQogICAgICAgIGlmIChpc1RyYW5zZm9ybVN1cHBvcnRlZCgpKSB7DQogICAgICAgICAgICB0aGlzLiRpbmRpY2F0b3Iuc2hvdygpOw0KICAgICAgICAgICAgdGhpcy4kbWFzay5jc3MoJ29wYWNpdHknLCB0aGlzLnNldHRpbmdzLm9wYWNpdHkpOw0KICAgICAgICB9DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFJvdGF0b3JWaWV3DQogICAgICovDQogICAgUm90YXRvclZpZXcucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIFZpZXcucHJvdG90eXBlLnJlc2V0LmNhbGwodGhpcyk7DQoNCiAgICAgICAgdGhpcy4kcm90YXRvci5zdG9wKHRydWUpOw0KICAgICAgICB0aGlzLnJlc2V0Q3NzKCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFJvdGF0b3JWaWV3DQogICAgICovDQogICAgUm90YXRvclZpZXcucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHRoaXMuJHJvdGF0b3Iuc3RvcCh0cnVlKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgUm90YXRvclZpZXcNCiAgICAgKi8NCiAgICBSb3RhdG9yVmlldy5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgcGhhc2UgPSB0aGlzLnBsYXlQaGFzZU9uZTsNCiAgICAgICAgaWYgKHRoaXMudGltZUVsYXBzZWQgPj0gdGhpcy50aW1lb3V0IC8gMikgew0KICAgICAgICAgICAgcGhhc2UgPSB0aGlzLnBsYXlQaGFzZVR3bzsNCiAgICAgICAgfQ0KDQogICAgICAgIHBoYXNlLmNhbGwodGhpcyk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgUm90YXRvclZpZXcgY2xhc3MNCiAgICAgKi8NCiAgICBwdWIuUm90YXRvclZpZXcgPSBSb3RhdG9yVmlldzsNCg0KICAgIHJldHVybiBwdWI7DQp9KGpRdWVyeSkpOw0KLyoqDQogKiBlbmQgb2YgWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cyBtb2R1bGUuDQogKi8=
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 61109
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20191112T083943Z
